{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport draggable from 'vuedraggable';\nexport default {\n  __name: 'WeekDrag',\n  props: {\n    table: Object,\n    tableData: Array,\n    week_day: String,\n    viewValue: String,\n    loading: Boolean\n  },\n  emits: ['emitTableData', 'handleClickTd', 'showAddView', 'message'],\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n    console.log(props.tableData);\n    //加载数据\n    const svg = `\n        <path class=\"path\" d=\"\n          M 30 15\n          L 28 17\n          M 25.61 25.61\n          A 15 15, 0, 0, 1, 15 30\n          A 15 15, 0, 1, 1, 27.99 7.5\n          L 15 15\n        \" style=\"stroke-width: 4px; fill: rgba(0, 0, 0, 0)\"/>\n      `;\n\n    //是否可拖拽drag，拖拽起点dragging，拖拽终点ending\n    const drag = ref(false);\n    const ending = ref(null);\n    const dragging = ref(null);\n\n    //开始拖拽、拖拽终点、结束拖拽\n    const startDrag = (e, index1, index2) => {\n      if (drag.value === false) return;\n      dragging.value = [index1, index2];\n      // console.log(index1, index2);\n    };\n\n    const enterDrag = (e, index1, index2) => {\n      if (drag.value === false) return;\n      ending.value = [index1, index2];\n      // console.log(index1, index2);\n    };\n\n    const endDrag = e => {\n      if (drag.value === false) return;\n      if (ending.value[0] === dragging.value[0] && ending.value[1] === dragging.value[1]) {\n        return;\n      }\n      var flag = false;\n      props.tableData[ending.value[0]][1][ending.value[1]][0].map(value => {\n        if (value.employeeId === props.tableData[dragging.value[0]][1][dragging.value[1]][0][e.oldIndex].employeeId) {\n          flag = true;\n          return;\n        }\n      });\n      if (flag === true) {\n        emit('message', '不能给同一个员工分配同一时间段的工作');\n        return;\n      }\n      var newData = [...props.tableData];\n      if (dragging.value[0] === ending.value[0]) {\n        let item = [...newData[dragging.value[0]]];\n        item[1][ending.value[1]][0].push(item[1][dragging.value[1]][0][e.oldIndex]);\n        item[1][dragging.value[1]][0].splice(e.oldIndex, 1);\n        newData[dragging.value[0]] = [...item];\n      } else {\n        let item1 = [...newData[dragging.value[0]]];\n        let item2 = [...newData[ending.value[0]]];\n        item2[1][ending.value[1]][0].push(item1[1][dragging.value[1]][0][e.oldIndex]);\n        item1[1][dragging.value[1]][0].splice(e.oldIndex, 1);\n        newData[dragging.value[0]] = [...item1];\n        newData[ending.value[0]] = [...item2];\n      }\n      emit('emitTableData', [...newData]);\n    };\n\n    //删除员工\n    const deleteItem = (index1, index2, index) => {\n      console.log(index1, index2, index);\n      let newData = [...props.tableData];\n      let item = [...newData[index1]];\n      item[1][index2][0].splice(index, 1);\n      newData[index1] = [...item];\n      emit('emitTableData', [...newData]);\n    };\n    const weekEdit = () => {\n      drag.value = drag.value === true ? false : true;\n    };\n    const initDrag = () => {\n      drag.value = false;\n    };\n    expose({\n      weekEdit,\n      initDrag\n    });\n    const __returned__ = {\n      props,\n      emit,\n      svg,\n      drag,\n      ending,\n      dragging,\n      startDrag,\n      enterDrag,\n      endDrag,\n      deleteItem,\n      weekEdit,\n      initDrag,\n      ref,\n      get draggable() {\n        return draggable;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","draggable","console","log","props","tableData","svg","drag","ending","dragging","startDrag","e","index1","index2","value","enterDrag","endDrag","flag","map","employeeId","oldIndex","emit","newData","item","push","splice","item1","item2","deleteItem","index","weekEdit","initDrag","expose"],"sources":["E:/work/vue/schedule/intelligent-schedule/src/components/WeekDrag.vue"],"sourcesContent":["<template>\r\n  <table class=\"table-out\">\r\n    <thead>\r\n    <tr>\r\n      <template v-for='(item, index) in table'>\r\n        <th class=\"item\">{{ item }}</th>\r\n      </template>\r\n    </tr>\r\n    </thead>\r\n    <tbody v-loading=\"loading\" element-loading-text=\"Loading...\" :element-loading-spinner=\"svg\"\r\n           element-loading-svg-view-box=\"-10, -10, 50, 50\" element-loading-background=\"rgba(130, 130, 130, 0.7)\">\r\n    <tr v-for='(shifts, i) in tableData' class=\"tr-out\">\r\n      <td class=\"td-out\" :title=\"shifts[0]\">\r\n        {{ shifts[0] }}\r\n      </td>\r\n      <template v-for=\"(value, j) in shifts[1]\">\r\n        <td class=\"td-out td\" :class=\"value[0] == null ? 'slash' : null\" :id=\"'td' + week_day + i + '-' + j\"\r\n            @click=\"(drag === false && value[0] != null) ? emit('handleClickTd', i, j) : null\">\r\n          <draggable v-if=\"value[0] != null\" :model-value=\"value[0]\" group=\"people\" animation=\"300\" item-key=\"key\"\r\n                     @start=\"startDrag($event, i, j)\" @end=\"endDrag($event)\" @dragenter=\"enterDrag($event, i, j)\">\r\n            <template #item=\"{ element, index }\">\r\n              <div class=\"item\" :class=\"(drag === true) ? 'move' : null\"\r\n                   :title=\"element.employeeName + ' ' + element.position\">\r\n                <el-icon v-if=\"drag === true\" :size=\"19\" class=\"icon-delete\" @click=\"deleteItem(i, j, index)\">\r\n                  <CircleClose />\r\n                </el-icon>\r\n                <span v-if=\"viewValue === '全部查看'\">\r\n                    {{ element.employeeName + ' ' + element.position }}\r\n                  </span>\r\n                <span v-else-if=\"viewValue === '按岗位分组'\">{{ element.position }}</span>\r\n                <span v-else>{{ element.employeeName }}</span>\r\n              </div>\r\n            </template>\r\n          </draggable>\r\n          <el-icon v-if=\"drag === true && value[0] != null\" :size=\"22\" class=\"icon-add\"\r\n                   @click=\"emit('showAddView', value[0], i, j)\">\r\n            <CirclePlus />\r\n          </el-icon>\r\n        </td>\r\n      </template>\r\n    </tr>\r\n    </tbody>\r\n  </table>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport draggable from 'vuedraggable';\r\n\r\nconst props = defineProps({\r\n  table: Object,\r\n  tableData: Array,\r\n  week_day: String,\r\n  viewValue: String,\r\n  loading: Boolean\r\n});\r\nconst emit = defineEmits(['emitTableData', 'handleClickTd', 'showAddView', 'message']);\r\n\r\nconsole.log(props.tableData)\r\n//加载数据\r\nconst svg = `\r\n        <path class=\"path\" d=\"\r\n          M 30 15\r\n          L 28 17\r\n          M 25.61 25.61\r\n          A 15 15, 0, 0, 1, 15 30\r\n          A 15 15, 0, 1, 1, 27.99 7.5\r\n          L 15 15\r\n        \" style=\"stroke-width: 4px; fill: rgba(0, 0, 0, 0)\"/>\r\n      `\r\n\r\n//是否可拖拽drag，拖拽起点dragging，拖拽终点ending\r\nconst drag = ref(false);\r\nconst ending = ref(null);\r\nconst dragging = ref(null);\r\n\r\n//开始拖拽、拖拽终点、结束拖拽\r\nconst startDrag = (e, index1, index2) => {\r\n  if (drag.value === false) return;\r\n  dragging.value = [index1, index2];\r\n  // console.log(index1, index2);\r\n}\r\nconst enterDrag = (e, index1, index2) => {\r\n  if (drag.value === false) return;\r\n  ending.value = [index1, index2];\r\n  // console.log(index1, index2);\r\n}\r\nconst endDrag = (e) => {\r\n  if (drag.value === false) return;\r\n  if (ending.value[0] === dragging.value[0] &&\r\n      ending.value[1] === dragging.value[1]) {\r\n    return;\r\n  }\r\n\r\n  var flag = false;\r\n  props.tableData[ending.value[0]][1][ending.value[1]][0].map((value) => {\r\n    if (value.employeeId === props.tableData[dragging.value[0]][1][dragging.value[1]][0][e.oldIndex].employeeId) {\r\n      flag = true;\r\n      return;\r\n    }\r\n  })\r\n  if (flag === true) {\r\n    emit('message', '不能给同一个员工分配同一时间段的工作');\r\n    return;\r\n  }\r\n\r\n  var newData = [...props.tableData];\r\n\r\n  if (dragging.value[0] === ending.value[0]) {\r\n    let item = [...newData[dragging.value[0]]];\r\n    item[1][ending.value[1]][0].push(item[1][dragging.value[1]][0][e.oldIndex]);\r\n    item[1][dragging.value[1]][0].splice(e.oldIndex, 1);\r\n\r\n    newData[dragging.value[0]] = [...item];\r\n  } else {\r\n    let item1 = [...newData[dragging.value[0]]];\r\n    let item2 = [...newData[ending.value[0]]];\r\n    item2[1][ending.value[1]][0].push(item1[1][dragging.value[1]][0][e.oldIndex]);\r\n    item1[1][dragging.value[1]][0].splice(e.oldIndex, 1);\r\n\r\n    newData[dragging.value[0]] = [...item1];\r\n    newData[ending.value[0]] = [...item2];\r\n  }\r\n\r\n  emit('emitTableData', [...newData]);\r\n}\r\n\r\n//删除员工\r\nconst deleteItem = (index1, index2, index) => {\r\n  console.log(index1, index2, index);\r\n\r\n  let newData = [...props.tableData];\r\n  let item = [...newData[index1]];\r\n\r\n  item[1][index2][0].splice(index, 1);\r\n  newData[index1] = [...item];\r\n\r\n  emit('emitTableData', [...newData]);\r\n}\r\n\r\nconst weekEdit = () => {\r\n  drag.value = (drag.value === true ? false : true);\r\n}\r\n\r\nconst initDrag = () => {\r\n  drag.value = false;\r\n}\r\n\r\ndefineExpose({\r\n  weekEdit,\r\n  initDrag\r\n})\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.table-out {\r\n  table-layout: fixed;\r\n  width: 100%;\r\n  text-align: center;\r\n  border-collapse: collapse;\r\n  border-spacing: 0;\r\n\r\n  thead tr th {\r\n    padding: 20px 15px;\r\n    font-weight: 500;\r\n    background: #e3e3e3;\r\n    transition: background .3s ease;\r\n    border: 1px solid #eee;\r\n\r\n    &:first-child {\r\n      border-top-left-radius: 5px;\r\n      border-left: none;\r\n      border-top: none;\r\n    }\r\n\r\n    &:last-child {\r\n      border-top-right-radius: 5px;\r\n      border-right: none;\r\n      border-top: none;\r\n    }\r\n  }\r\n\r\n  tbody .tr-out {\r\n    .td-out {\r\n      border: 1px solid #eee;\r\n      transition: background .3s;\r\n      overflow: hidden;\r\n      white-space: nowrap;\r\n      text-overflow: ellipsis;\r\n      padding: 10px;\r\n\r\n      .item {\r\n        padding: 3px 10px;\r\n        transition: background .3s;\r\n        overflow: hidden;\r\n        white-space: nowrap;\r\n        text-overflow: ellipsis;\r\n      }\r\n\r\n      .icon-delete {\r\n        margin-right: 5px;\r\n        vertical-align: middle;\r\n        color: #ff6b6b;\r\n        transition: all 0.5s;\r\n      }\r\n\r\n      .icon-delete:hover {\r\n        cursor: pointer;\r\n        transform: rotateZ(180deg);\r\n      }\r\n\r\n      .icon-add {\r\n        margin-top: 10px;\r\n        transition: all 0.5s;\r\n        color: #0a85ff;\r\n      }\r\n\r\n      .icon-add:hover {\r\n        cursor: pointer;\r\n        border: #0a85ff 1px solid;\r\n        border-radius: 10px;\r\n        padding: 5px;\r\n      }\r\n    }\r\n\r\n    .slash {\r\n      background: #fff url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxsaW5lIHgxPSIwIiB5MT0iMCIgeDI9IjEwMCUiIHkyPSIxMDAlIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=) no-repeat 100% center;\r\n    }\r\n\r\n    .slash:hover {\r\n      cursor: none;\r\n    }\r\n\r\n    .td:hover {\r\n      cursor: pointer;\r\n    }\r\n\r\n    .move {\r\n      margin: 2px;\r\n      padding: 10px;\r\n      background-color: #f1f1f1;\r\n      border-radius: 5px;\r\n    }\r\n\r\n    .move:hover {\r\n      background-color: #b6dbff;\r\n      cursor: move;\r\n    }\r\n\r\n    .move-day:hover {\r\n      background-color: #b6dbff;\r\n      cursor: move;\r\n    }\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}