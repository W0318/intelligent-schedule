{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createBlock as _createBlock, withModifiers as _withModifiers, normalizeClass as _normalizeClass, resolveDirective as _resolveDirective, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"table-out\"\n};\nconst _hoisted_2 = {\n  class: \"tr-out\"\n};\nconst _hoisted_3 = [\"title\"];\nconst _hoisted_4 = [\"id\", \"title\", \"onClick\", \"draggable\", \"onDragstart\", \"onDragenter\"];\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  key: 0\n};\nconst _hoisted_7 = {\n  key: 1\n};\nconst _hoisted_8 = {\n  key: 2\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_CirclePlus = _resolveComponent(\"CirclePlus\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _directive_loading = _resolveDirective(\"loading\");\n  return _openBlock(), _createElementBlock(\"table\", _hoisted_1, [_withDirectives((_openBlock(), _createElementBlock(\"tbody\", {\n    \"element-loading-text\": \"Loading...\",\n    \"element-loading-spinner\": $setup.svg,\n    \"element-loading-svg-view-box\": \"-10, -10, 50, 50\",\n    \"element-loading-background\": \"rgba(130, 130, 130, 0.7)\"\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($props.dayData, (row, index1) => {\n    return _openBlock(), _createElementBlock(\"tr\", _hoisted_2, [_createElementVNode(\"td\", {\n      id: \"td-time\",\n      class: \"td-out\",\n      style: {\n        \"background-color\": \"#e3e3e3\"\n      },\n      title: row[1]\n    }, _toDisplayString(row[1]), 9 /* TEXT, PROPS */, _hoisted_3), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(row[0], (item, index2) => {\n      return _openBlock(), _createElementBlock(\"td\", {\n        class: _normalizeClass([\"td-out td\", $setup.drag === true ? 'move-day' : null]),\n        id: 'td' + $props.week_day + index1 + '-' + index2,\n        title: item.employeeId !== null && JSON.stringify(item) !== '{}' ? item.employeeName + ' ' + item.position : null,\n        onClick: $event => $setup.drag === false ? $setup.emit('handleClickTd', index1, index2) : null,\n        draggable: $setup.drag === true ? true : false,\n        onDragstart: $event => $setup.handleDragStart($event, index1, index2),\n        onDragover: _cache[0] || (_cache[0] = _withModifiers($event => $setup.handleDragOver($event), [\"prevent\"])),\n        onDragenter: $event => $setup.handleDragEnter($event, index1, index2),\n        onDragend: _cache[1] || (_cache[1] = $event => $setup.handleDragEnd($event))\n      }, [item.employeeId !== null && JSON.stringify(item) !== '{}' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [$props.viewValue === '全部查看' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, _toDisplayString(item.employeeName + ' ' + item.position), 1 /* TEXT */)) : $props.viewValue === '按岗位分组' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_7, _toDisplayString(item.position), 1 /* TEXT */)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_8, _toDisplayString(item.employeeName), 1 /* TEXT */))])) : $setup.drag === true ? (_openBlock(), _createBlock(_component_el_icon, {\n        key: 1,\n        size: 22,\n        class: \"icon-add\",\n        onClick: $event => $setup.emit('showAddView', [], index1, index2)\n      }, {\n        default: _withCtx(() => [_createVNode(_component_CirclePlus)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true)], 42 /* CLASS, PROPS, HYDRATE_EVENTS */, _hoisted_4);\n    }), 256 /* UNKEYED_FRAGMENT */))]);\n  }), 256 /* UNKEYED_FRAGMENT */))])), [[_directive_loading, $props.loading]])]);\n}","map":{"version":3,"mappings":";;EACWA,KAAK,EAAC;AAAW;;EAGqBA,KAAK,EAAC;AAAQ;;;;;;;;;;;;;;;;;;;uBAH3DC,oBA8BQ,SA9BRC,UA8BQ,kCA7BJD,oBA4BQ;IA5BmB,sBAAoB,EAAC,YAAY;IAAE,yBAAuB,EAAEE,UAAG;IACtF,8BAA4B,EAAC,kBAAkB;IAAC,4BAA0B,EAAC;yBAC3EF,oBAyBKG,6BAzBuBC,cAAO,GAAvBC,GAAG,EAAEC,MAAM;yBAAvBN,oBAyBK,MAzBLO,UAyBK,GAxBDC,oBAEK;MAFDC,EAAE,EAAC,SAAS;MAACV,KAAK,EAAC,QAAQ;MAACW,KAAkC,EAAlC;QAAA;MAAA,CAAkC;MAAEC,KAAK,EAAEN,GAAG;wBACxEA,GAAG,2DAETL,oBAoBWG,6BApBwBE,GAAG,MAApBO,IAAI,EAAEC,MAAM;2BAC1Bb,oBAkBK;QAlBDD,KAAK,mBAAC,WAAW,EAASG,WAAI;QAC7BO,EAAE,SAASL,eAAQ,GAAGE,MAAM,SAASO,MAAM;QAAGF,KAAK,EAAGC,IAAI,CAACE,UAAU,aAAaC,IAAI,CAACC,SAAS,CAACJ,IAAI,aAA4CA,IAAI,CAACK,YAAY,SAASL,IAAI,CAACM,QAAQ;QAExLC,OAAK,YAAEjB,WAAI,aAAaA,WAAI,kBAAkBI,MAAM,EAAEO,MAAM;QAC5DO,SAAS,EAAElB,WAAI;QAA2BmB,WAAS,YAAEnB,sBAAe,CAACoB,MAAM,EAAEhB,MAAM,EAAEO,MAAM;QAC3FU,UAAQ,qDAAUrB,qBAAc,CAACoB,MAAM;QAAIE,WAAS,YAAEtB,sBAAe,CAACoB,MAAM,EAAEhB,MAAM,EAAEO,MAAM;QAC5FY,SAAO,sCAAEvB,oBAAa,CAACoB,MAAM;UACnBV,IAAI,CAACE,UAAU,aAAaC,IAAI,CAACC,SAAS,CAACJ,IAAI,4BAA1DZ,oBAMM,oBALUI,gBAAS,6BAArBJ,oBAEO,qCADAY,IAAI,CAACK,YAAY,SAASL,IAAI,CAACM,QAAQ,oBAE7Bd,gBAAS,8BAA1BJ,oBAAkE,qCAAvBY,IAAI,CAACM,QAAQ,mCACxDlB,oBAA2C,qCAA3BY,IAAI,CAACK,YAAY,uBAEjBf,WAAI,2BAAxBwB,aAGUC;;QAH0BC,IAAI,EAAE,EAAE;QAAE7B,KAAK,EAAC,UAAU;QACzDoB,OAAK,YAAEjB,WAAI,oBAAoBI,MAAM,EAAEO,MAAM;;0BAC9C,MAAc,CAAdgB,aAAcC;;;;6DAvBhB1B,cAAO","names":["class","_createElementBlock","_hoisted_1","$setup","_Fragment","$props","row","index1","_hoisted_2","_createElementVNode","id","style","title","item","index2","employeeId","JSON","stringify","employeeName","position","onClick","draggable","onDragstart","$event","onDragover","onDragenter","onDragend","_createBlock","_component_el_icon","size","_createVNode","_component_CirclePlus"],"sourceRoot":"","sources":["E:\\work\\vue\\schedule\\intelligent-schedule\\src\\components\\DayDrag.vue"],"sourcesContent":["<template>\r\n    <table class=\"table-out\">\r\n        <tbody v-loading=\"loading\" element-loading-text=\"Loading...\" :element-loading-spinner=\"svg\"\r\n            element-loading-svg-view-box=\"-10, -10, 50, 50\" element-loading-background=\"rgba(130, 130, 130, 0.7)\">\r\n            <tr v-for='(row, index1) in dayData' class=\"tr-out\">\r\n                <td id=\"td-time\" class=\"td-out\" style=\"background-color: #e3e3e3;\" :title=\"row[1]\">\r\n                    {{row[1]}}\r\n                </td>\r\n                <template v-for='(item, index2) in row[0]'>\r\n                    <td class=\"td-out td\" :class=\"drag === true ? 'move-day' : null\"\r\n                        :id=\"'td' + week_day + index1 + '-' + index2\" :title=\"(item.employeeId !== null && JSON.stringify(item) !== '{}') ?\r\n                            (item.employeeName + ' ' + item.position) : null\"\r\n                        @click=\"drag === false ? emit('handleClickTd', index1, index2) : null\"\r\n                        :draggable=\"drag === true ? true : false\" @dragstart=\"handleDragStart($event, index1, index2)\"\r\n                        @dragover.prevent=\"handleDragOver($event)\" @dragenter=\"handleDragEnter($event, index1, index2)\"\r\n                        @dragend=\"handleDragEnd($event)\">\r\n                        <div v-if=\"item.employeeId !== null && JSON.stringify(item) !== '{}'\">\r\n                            <span v-if=\"viewValue === '全部查看'\">\r\n                                {{ item.employeeName + ' ' + item.position }}\r\n                            </span>\r\n                            <span v-else-if=\"viewValue === '按岗位分组'\">{{ item.position }}</span>\r\n                            <span v-else>{{ item.employeeName }}</span>\r\n                        </div>\r\n                        <el-icon v-else-if=\"drag === true\" :size=\"22\" class=\"icon-add\"\r\n                            @click=\"emit('showAddView', [], index1, index2)\">\r\n                            <CirclePlus />\r\n                        </el-icon>\r\n                    </td>\r\n                </template>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport moment from \"moment\";\r\n\r\nconst props = defineProps({\r\n    dayData: Array,\r\n    week_day: String,\r\n    viewValue: String,\r\n    loading: Boolean,\r\n    current: typeof (moment()),\r\n    timesDay: Array\r\n});\r\nconst emit = defineEmits(['emitDayData', 'handleClickTd', 'showAddView', 'message']);\r\n\r\nconst svg = `\r\n        <path class=\"path\" d=\"\r\n          M 30 15\r\n          L 28 17\r\n          M 25.61 25.61\r\n          A 15 15, 0, 0, 1, 15 30\r\n          A 15 15, 0, 1, 1, 27.99 7.5\r\n          L 15 15\r\n        \" style=\"stroke-width: 4px; fill: rgba(0, 0, 0, 0)\"/>\r\n      `\r\n\r\n//是否可拖拽drag，拖拽起点dragging，拖拽终点ending\r\nconst drag = ref(false);\r\nconst ending = ref(null);\r\nconst dragging = ref(null);\r\n\r\n//按日查看拖拽\r\nconst handleDragStart = (e, row, col) => {\r\n    // console.log(row, col);\r\n    dragging.value = [row, col];\r\n}\r\nconst handleDragEnd = (e) => {\r\n    if (ending.value[0] === dragging.value[0] &&\r\n        ending.value[1] === dragging.value[1]) {\r\n        return;\r\n    }\r\n    if (dragging.value[1] === 'time' || ending.value[1] === 'time')\r\n        return;\r\n\r\n    var newData = [...props.dayData];\r\n    var flag = false;\r\n    var start = newData[dragging.value[0]][0][dragging.value[1]];\r\n    var end = newData[ending.value[0]][0][ending.value[1]];\r\n    props.dayData[dragging.value[0]].map(value => {\r\n        if (flag === true) return;\r\n        if (JSON.stringify(value[0]) !== '{}' && value[0].employeeId !== null) {\r\n            if (JSON.stringify(end) !== '{}' && end.employeeId !== null && value[0].employeeId === end.employeeId) {\r\n                flag = true;\r\n                return;\r\n            }\r\n        }\r\n    });\r\n    props.dayData[ending.value[0]].map(value => {\r\n        if (flag === true) return;\r\n        if (JSON.stringify(value[0]) !== '{}' && value[0].employeeId !== null) {\r\n            if (JSON.stringify(start) !== '{}' && start.employeeId !== null && value[0].employeeId === start.employeeId) {\r\n                flag = true;\r\n                return;\r\n            }\r\n        }\r\n    });\r\n    if (flag === true) {\r\n        emit('message', '不能给同一个员工分配同一时间段的工作');\r\n        return;\r\n    }\r\n\r\n    if (dragging.value[0] === ending.value[0]) {\r\n        let item = [...newData[dragging.value[0]]];\r\n        let temp = item[0][dragging.value[1]];\r\n        item[0][dragging.value[1]] = item[0][ending.value[1]];\r\n        item[0][ending.value[1]] = temp;\r\n\r\n        newData[dragging.value[0]] = [...item];\r\n    }\r\n    else {\r\n        let item1 = [...newData[dragging.value[0]]];\r\n        let item2 = [...newData[ending.value[0]]];\r\n        let temp = item1[0][dragging.value[1]];\r\n        item1[0][dragging.value[1]] = item2[0][ending.value[1]];\r\n        item2[0][ending.value[1]] = temp;\r\n\r\n        newData[dragging.value[0]] = [...item1];\r\n        newData[ending.value[0]] = [...item2];\r\n    }\r\n\r\n    console.log([...newData])\r\n    emit('emitDayData', [...newData]);\r\n    dragging.value = null;\r\n    ending.value = null;\r\n}\r\nconst handleDragOver = (e) => {\r\n    e.dataTransfer.dropEffect = \"move\";\r\n}\r\nconst handleDragEnter = (e, row, col) => {\r\n    // console.log(row, col);\r\n    e.dataTransfer.effectAllowed = \"move\";\r\n    ending.value = [row, col];\r\n}\r\n\r\nconst initDrag = () => {\r\n    drag.value = false;\r\n}\r\n\r\nconst dayEdit = () => {\r\n    drag.value = (drag.value === true ? false : true);\r\n}\r\ndefineExpose({\r\n    dayEdit,\r\n    initDrag\r\n})\r\n</script>\r\n\r\n<style lang=\"less\"></style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}