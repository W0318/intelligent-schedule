{"ast":null,"code":"import \"core-js/modules/es.array.unshift.js\";\nimport { getCloseshopRule, updateCloseshop, getCloseByStoreId, insertClose, getAllRule, updateCloseByStoreId } from \"@/api\";\nexport default {\n  inject: [\"reload\"],\n  name: \"CloseShop\",\n  data() {\n    return {\n      rulenamee: \"\",\n      rulevaluee: \"\",\n      label111: -1,\n      //修改通用规则则为0，用通用规则但是分店则为1\n      label000: 0,\n      lengthh: 0,\n      sstr: \"\",\n      tableData: [],\n      tableDatas: {\n        ruleTitle: \"\",\n        ruleValue: \"\"\n      },\n      addDialogVisible: false,\n      NoDelete: false,\n      NoDelete1: false,\n      Noemptyy: false,\n      addForm: {\n        ruleName: \"\",\n        ruleContent: \"\"\n      }\n    };\n  },\n  mounted() {\n    //获取通用规则\n    this.label111 = sessionStorage.getItem(\"label111\");\n    if (this.label111 != -1) {\n      getCloseByStoreId(this.label111).then(datas => {\n        if (datas.data.length == 0) {\n          getCloseshopRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"关店后清点所需人数公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            const rules1 = {\n              ruleTitle: \"关店后清点所需时间\",\n              ruleValue: json.after\n            };\n            this.tableData.unshift(rules1);\n            console.log(datas.data);\n            this.label000 = 1;\n          });\n        } else if (datas.data[0].ruleValue == '{\"after\": \"\", \"formula\": \"\", \"position\": \"\"}') {\n          getCloseshopRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"关店后清点所需人数公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            const rules1 = {\n              ruleTitle: \"关店后清点所需时间\",\n              ruleValue: json.after\n            };\n            this.tableData.unshift(rules1);\n            console.log(datas.data);\n          });\n        } else {\n          this.tableData = datas.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.position;\n          this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n          const rules = {\n            ruleTitle: \"关店后清点所需人数公式\",\n            ruleValue: json.formula\n          };\n          this.tableData.unshift(rules);\n          const rules1 = {\n            ruleTitle: \"关店后清点所需时间\",\n            ruleValue: json.after\n          };\n          this.tableData.unshift(rules1);\n          console.log(datas.data);\n        }\n      });\n    } else if (this.label111 == -1) {\n      getCloseshopRule().then(datas => {\n        this.tableData = datas.data;\n        let json = JSON.parse(this.tableData[0].ruleValue);\n        this.tableData[0].ruleValue = json.position;\n        this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n        const rules = {\n          ruleTitle: \"关店后清点所需人数公式\",\n          ruleValue: json.formula\n        };\n        this.tableData.unshift(rules);\n        const rules1 = {\n          ruleTitle: \"关店后清点所需时间\",\n          ruleValue: json.after\n        };\n        this.tableData.unshift(rules1);\n        console.log(datas.data);\n      });\n    }\n  },\n  methods: {\n    handleEdit(index, row) {\n      getAllRule().then(datas => {\n        // console.log(datas.data.length);\n        console.log(\"label000:\" + this.label000);\n        console.log(\"label111:\" + this.label111);\n      });\n      this.addDialogVisible = true;\n      this.rulenamee = this.tableData[index].ruleTitle;\n      // console.log(this.rulenamee);\n      this.rulevaluee = this.tableData[index].ruleValue;\n      // console.log(this.rulevaluee);\n    },\n\n    //删除规则\n    async handleDelete(index, row) {\n      this.rulenamee = this.tableData[index].ruleTitle;\n      if (this.label111 != -1 && this.label000 == 0) {\n        if (this.rulenamee == \"关店后清点所需时间\") {\n          await getCloseshopRule().then(datass => {\n            this.tableData1 = datass.data;\n            console.log(this.tableData1);\n            let json = JSON.parse(this.tableData1[0].ruleValue);\n            this.sstr = '{\"after\": ' + json.after + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n            console.log(this.sstr);\n          });\n        } else if (this.rulenamee == \"关店后清点所需人数公式\") {\n          this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n          console.log(this.sstr);\n        } else {\n          this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"\"}';\n          console.log(this.sstr);\n        }\n        await updateCloseByStoreId(this.label111, this.sstr);\n        await getCloseByStoreId(this.label111).then(datass => {\n          this.tableData = datass.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.position;\n          this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n          const rules = {\n            ruleTitle: \"关店后清点所需人数公式\",\n            ruleValue: json.formula\n          };\n          this.tableData.unshift(rules);\n          const rules1 = {\n            ruleTitle: \"关店后清点所需时间\",\n            ruleValue: json.after\n          };\n          this.tableData.unshift(rules1);\n          console.log(datass.data);\n        });\n      } else if (this.label111 == -1) {\n        this.NoDelete = true;\n      } else {\n        this.NoDelete1 = true;\n      }\n    },\n    //点击确认编辑button确认编辑规则\n    async handelUpdate() {\n      if (this.rulevaluee == \"\") {\n        this.Noemptyy = true;\n      } else {\n        //是分店\n        if (this.label111 != -1) {\n          //分店无独立规则则插入一条新规则\n          if (this.label000 == 1) {\n            if (this.rulenamee == \"关店后清点所需时间\") {\n              this.sstr = '{\"after\": ' + this.rulevaluee + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else if (this.rulenamee == \"关店后清点所需人数公式\") {\n              this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            getAllRule().then(async datas => {\n              this.lengthh = datas.data.length + 1;\n              this.lengthh = this.lengthh.toString();\n              console.log(this.lengthh);\n              console.log(this.label111);\n              await insertClose(this.lengthh, this.label111, this.sstr);\n              this.addDialogVisible = false;\n              await getCloseByStoreId(this.label111).then(datass => {\n                this.tableData = datass.data;\n                let json = JSON.parse(this.tableData[0].ruleValue);\n                this.tableData[0].ruleValue = json.position;\n                this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n                const rules = {\n                  ruleTitle: \"关店后清点所需人数公式\",\n                  ruleValue: json.formula\n                };\n                this.tableData.unshift(rules);\n                const rules1 = {\n                  ruleTitle: \"关店后清点所需时间\",\n                  ruleValue: json.after\n                };\n                this.tableData.unshift(rules1);\n                console.log(datass.data);\n              });\n              // this.reload();\n            });\n          }\n          //分店有独立规则则进行编辑（update\n          else {\n            if (this.rulenamee == \"关店后清点所需时间\") {\n              this.sstr = '{\"after\": ' + this.rulevaluee + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else if (this.rulenamee == \"关店后清点所需人数公式\") {\n              this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            await updateCloseByStoreId(this.label111, this.sstr);\n            this.addDialogVisible = false;\n            await getCloseByStoreId(this.label111).then(datass => {\n              this.tableData = datass.data;\n              let json = JSON.parse(this.tableData[0].ruleValue);\n              this.tableData[0].ruleValue = json.position;\n              this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n              const rules = {\n                ruleTitle: \"关店后清点所需人数公式\",\n                ruleValue: json.formula\n              };\n              this.tableData.unshift(rules);\n              const rules1 = {\n                ruleTitle: \"关店后清点所需时间\",\n                ruleValue: json.after\n              };\n              this.tableData.unshift(rules1);\n              console.log(datass.data);\n            });\n            // this.reload();\n          }\n        }\n        //不是分店\n        else {\n          if (this.rulenamee == \"关店后清点所需时间\") {\n            this.sstr = '{\"after\": ' + this.rulevaluee + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n            console.log(this.sstr);\n          } else if (this.rulenamee == \"关店后清点所需人数公式\") {\n            this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n            console.log(this.sstr);\n          } else {\n            this.sstr = '{\"after\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n            console.log(this.sstr);\n          }\n          console.log(this.rulevaluee);\n          await updateCloseshop(this.sstr);\n          this.addDialogVisible = false;\n          await getCloseshopRule().then(datass => {\n            this.tableData = datass.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"关店后清点所需人数公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            const rules1 = {\n              ruleTitle: \"关店后清点所需时间\",\n              ruleValue: json.after\n            };\n            this.tableData.unshift(rules1);\n            console.log(datass.data);\n          });\n          // this.reload();\n        }\n      }\n    },\n\n    getCloseshopRules() {\n      getCloseshopRule().then(datas => {\n        this.tableData.ruleId = datas.data[0].ruleTitle;\n        console.log(datas.data);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["getCloseshopRule","updateCloseshop","getCloseByStoreId","insertClose","getAllRule","updateCloseByStoreId","inject","name","data","rulenamee","rulevaluee","label111","label000","lengthh","sstr","tableData","tableDatas","ruleTitle","ruleValue","addDialogVisible","NoDelete","NoDelete1","Noemptyy","addForm","ruleName","ruleContent","mounted","sessionStorage","getItem","then","datas","length","json","JSON","parse","position","rules","formula","unshift","rules1","after","console","log","methods","handleEdit","index","row","handleDelete","datass","tableData1","handelUpdate","toString","getCloseshopRules","ruleId"],"sourceRoot":"","sources":["E:\\work\\vue\\schedule\\intelligent-schedule\\src\\views\\ShiftSchedule\\components\\CloseShopRules.vue"],"sourcesContent":["<template>\r\n  <div class=\"rules\">\r\n    <div class=\"title\">\r\n      <h2>关店规则</h2>\r\n    </div>\r\n    <div class=\"rulesList\">\r\n      <el-table :data=\"tableData\" style=\"width: 100%\" stripe>\r\n        <el-table-column label=\"\" prop=\"ruleTitle\"> </el-table-column>\r\n        <el-table-column label=\"\" prop=\"ruleValue\"> </el-table-column>\r\n        <el-table-column label=\"\">\r\n          <template v-slot=\"scope\">\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"primary\"\r\n              @click=\"handleEdit(scope.$index, scope.row)\"\r\n            >\r\n              编辑\r\n            </el-link>\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"danger\"\r\n              @click=\"handleDelete(scope.$index, scope.row)\"\r\n              >删除</el-link\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <!-- 编辑规则对话框 -->\r\n    <el-dialog v-model=\"addDialogVisible\" title=\"编辑规则\" width=\"30%\">\r\n      <el-form :model=\"addForm\">\r\n        <el-form-item :label=\"rulenamee\" label-width=\"66%\"> </el-form-item>\r\n        <el-form-item label=\"规则内容：\" prop=\"rulevaluee\">\r\n          <el-input\r\n            v-model=\"this.rulevaluee\"\r\n            placeholder=\"请输入规则内容\"\r\n            clearable\r\n            :style=\"{ width: '100%' }\"\r\n          >\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handelUpdate\"> 确定 </el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm\">\r\n        <el-form-item label=\"无法删除通用规则\" label-width=\"66%\" prop=\"nono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete1\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm1\">\r\n        <el-form-item\r\n          label=\"该分店无独立规则，无法进行删除操作\"\r\n          label-width=\"90%\"\r\n          prop=\"nono\"\r\n        >\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete1 = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"Noemptyy\" title=\"不能为空\" width=\"30%\">\r\n      <el-form :model=\"Noempty\">\r\n        <el-form-item label=\"输入值不能为空\" label-width=\"66%\" prop=\"nonono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"Noemptyy = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getCloseshopRule,\r\n  updateCloseshop,\r\n  getCloseByStoreId,\r\n  insertClose,\r\n  getAllRule,\r\n  updateCloseByStoreId,\r\n} from \"@/api\";\r\n\r\nexport default {\r\n  inject: [\"reload\"],\r\n  name: \"CloseShop\",\r\n  data() {\r\n    return {\r\n      rulenamee: \"\",\r\n      rulevaluee: \"\",\r\n      label111: -1,\r\n      //修改通用规则则为0，用通用规则但是分店则为1\r\n      label000: 0,\r\n      lengthh: 0,\r\n\r\n      sstr: \"\",\r\n\r\n      tableData: [],\r\n      tableDatas: {\r\n        ruleTitle: \"\",\r\n        ruleValue: \"\",\r\n      },\r\n\r\n      addDialogVisible: false,\r\n      NoDelete: false,\r\n      NoDelete1: false,\r\n      Noemptyy: false,\r\n      addForm: {\r\n        ruleName: \"\",\r\n        ruleContent: \"\",\r\n      },\r\n    };\r\n  },\r\n\r\n  mounted() {\r\n    //获取通用规则\r\n    this.label111 = sessionStorage.getItem(\"label111\");\r\n    if (this.label111 != -1) {\r\n      getCloseByStoreId(this.label111).then((datas) => {\r\n        if (datas.data.length == 0) {\r\n          getCloseshopRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"关店后清点所需人数公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            const rules1 = {\r\n              ruleTitle: \"关店后清点所需时间\",\r\n              ruleValue: json.after,\r\n            };\r\n            this.tableData.unshift(rules1);\r\n            console.log(datas.data);\r\n            this.label000 = 1;\r\n          });\r\n        } else if (\r\n          datas.data[0].ruleValue ==\r\n          '{\"after\": \"\", \"formula\": \"\", \"position\": \"\"}'\r\n        ) {\r\n          getCloseshopRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"关店后清点所需人数公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            const rules1 = {\r\n              ruleTitle: \"关店后清点所需时间\",\r\n              ruleValue: json.after,\r\n            };\r\n            this.tableData.unshift(rules1);\r\n            console.log(datas.data);\r\n          });\r\n        } else {\r\n          this.tableData = datas.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.position;\r\n          this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n          const rules = {\r\n            ruleTitle: \"关店后清点所需人数公式\",\r\n            ruleValue: json.formula,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          const rules1 = {\r\n            ruleTitle: \"关店后清点所需时间\",\r\n            ruleValue: json.after,\r\n          };\r\n          this.tableData.unshift(rules1);\r\n          console.log(datas.data);\r\n        }\r\n      });\r\n    } else if (this.label111 == -1) {\r\n      getCloseshopRule().then((datas) => {\r\n        this.tableData = datas.data;\r\n        let json = JSON.parse(this.tableData[0].ruleValue);\r\n        this.tableData[0].ruleValue = json.position;\r\n        this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n        const rules = {\r\n          ruleTitle: \"关店后清点所需人数公式\",\r\n          ruleValue: json.formula,\r\n        };\r\n        this.tableData.unshift(rules);\r\n        const rules1 = {\r\n          ruleTitle: \"关店后清点所需时间\",\r\n          ruleValue: json.after,\r\n        };\r\n        this.tableData.unshift(rules1);\r\n        console.log(datas.data);\r\n      });\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    handleEdit(index, row) {\r\n      getAllRule().then((datas) => {\r\n        // console.log(datas.data.length);\r\n        console.log(\"label000:\" + this.label000);\r\n        console.log(\"label111:\" + this.label111);\r\n      });\r\n      this.addDialogVisible = true;\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      // console.log(this.rulenamee);\r\n      this.rulevaluee = this.tableData[index].ruleValue;\r\n      // console.log(this.rulevaluee);\r\n    },\r\n\r\n    //删除规则\r\n    async handleDelete(index, row) {\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      if (this.label111 != -1 && this.label000 == 0) {\r\n        if (this.rulenamee == \"关店后清点所需时间\") {\r\n          await getCloseshopRule().then((datass) => {\r\n            this.tableData1 = datass.data;\r\n            console.log(this.tableData1);\r\n            let json = JSON.parse(this.tableData1[0].ruleValue);\r\n            this.sstr =\r\n              '{\"after\": ' +\r\n              json.after +\r\n              ', \"formula\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.tableData[2].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          });\r\n        } else if (this.rulenamee == \"关店后清点所需人数公式\") {\r\n          this.sstr =\r\n            '{\"after\": ' +\r\n            this.tableData[0].ruleValue +\r\n            ', \"formula\": \"\", \"position\": \"' +\r\n            this.tableData[2].ruleValue +\r\n            '\"}';\r\n          console.log(this.sstr);\r\n        } else {\r\n          this.sstr =\r\n            '{\"after\": ' +\r\n            this.tableData[0].ruleValue +\r\n            ', \"formula\": \"' +\r\n            this.tableData[1].ruleValue +\r\n            '\", \"position\": \"\"}';\r\n          console.log(this.sstr);\r\n        }\r\n        await updateCloseByStoreId(this.label111, this.sstr);\r\n\r\n        await getCloseByStoreId(this.label111).then((datass) => {\r\n          this.tableData = datass.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.position;\r\n          this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n          const rules = {\r\n            ruleTitle: \"关店后清点所需人数公式\",\r\n            ruleValue: json.formula,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          const rules1 = {\r\n            ruleTitle: \"关店后清点所需时间\",\r\n            ruleValue: json.after,\r\n          };\r\n          this.tableData.unshift(rules1);\r\n          console.log(datass.data);\r\n        });\r\n      } else if (this.label111 == -1) {\r\n        this.NoDelete = true;\r\n      } else {\r\n        this.NoDelete1 = true;\r\n      }\r\n    },\r\n\r\n    //点击确认编辑button确认编辑规则\r\n    async handelUpdate() {\r\n      if (this.rulevaluee == \"\") {\r\n        this.Noemptyy = true;\r\n      } else {\r\n        //是分店\r\n        if (this.label111 != -1) {\r\n          //分店无独立规则则插入一条新规则\r\n          if (this.label000 == 1) {\r\n            if (this.rulenamee == \"关店后清点所需时间\") {\r\n              this.sstr =\r\n                '{\"after\": ' +\r\n                this.rulevaluee +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else if (this.rulenamee == \"关店后清点所需人数公式\") {\r\n              this.sstr =\r\n                '{\"after\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.rulevaluee +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else {\r\n              this.sstr =\r\n                '{\"after\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.rulevaluee +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            }\r\n            getAllRule().then(async (datas) => {\r\n              this.lengthh = datas.data.length + 1;\r\n              this.lengthh = this.lengthh.toString();\r\n              console.log(this.lengthh);\r\n              console.log(this.label111);\r\n              await insertClose(this.lengthh, this.label111, this.sstr);\r\n              this.addDialogVisible = false;\r\n\r\n              await getCloseByStoreId(this.label111).then((datass) => {\r\n                this.tableData = datass.data;\r\n                let json = JSON.parse(this.tableData[0].ruleValue);\r\n                this.tableData[0].ruleValue = json.position;\r\n                this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n                const rules = {\r\n                  ruleTitle: \"关店后清点所需人数公式\",\r\n                  ruleValue: json.formula,\r\n                };\r\n                this.tableData.unshift(rules);\r\n                const rules1 = {\r\n                  ruleTitle: \"关店后清点所需时间\",\r\n                  ruleValue: json.after,\r\n                };\r\n                this.tableData.unshift(rules1);\r\n                console.log(datass.data);\r\n              });\r\n              // this.reload();\r\n            });\r\n          }\r\n          //分店有独立规则则进行编辑（update\r\n          else {\r\n            if (this.rulenamee == \"关店后清点所需时间\") {\r\n              this.sstr =\r\n                '{\"after\": ' +\r\n                this.rulevaluee +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else if (this.rulenamee == \"关店后清点所需人数公式\") {\r\n              this.sstr =\r\n                '{\"after\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.rulevaluee +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else {\r\n              this.sstr =\r\n                '{\"after\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.rulevaluee +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            }\r\n            await updateCloseByStoreId(this.label111, this.sstr);\r\n            this.addDialogVisible = false;\r\n\r\n            await getCloseByStoreId(this.label111).then((datass) => {\r\n              this.tableData = datass.data;\r\n              let json = JSON.parse(this.tableData[0].ruleValue);\r\n              this.tableData[0].ruleValue = json.position;\r\n              this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n              const rules = {\r\n                ruleTitle: \"关店后清点所需人数公式\",\r\n                ruleValue: json.formula,\r\n              };\r\n              this.tableData.unshift(rules);\r\n              const rules1 = {\r\n                ruleTitle: \"关店后清点所需时间\",\r\n                ruleValue: json.after,\r\n              };\r\n              this.tableData.unshift(rules1);\r\n              console.log(datass.data);\r\n            });\r\n            // this.reload();\r\n          }\r\n        }\r\n        //不是分店\r\n        else {\r\n          if (this.rulenamee == \"关店后清点所需时间\") {\r\n            this.sstr =\r\n              '{\"after\": ' +\r\n              this.rulevaluee +\r\n              ', \"formula\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.tableData[2].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else if (this.rulenamee == \"关店后清点所需人数公式\") {\r\n            this.sstr =\r\n              '{\"after\": ' +\r\n              this.tableData[0].ruleValue +\r\n              ', \"formula\": \"' +\r\n              this.rulevaluee +\r\n              '\", \"position\": \"' +\r\n              this.tableData[2].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else {\r\n            this.sstr =\r\n              '{\"after\": ' +\r\n              this.tableData[0].ruleValue +\r\n              ', \"formula\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.rulevaluee +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          }\r\n          console.log(this.rulevaluee);\r\n          await updateCloseshop(this.sstr);\r\n          this.addDialogVisible = false;\r\n\r\n          await getCloseshopRule().then((datass) => {\r\n            this.tableData = datass.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"关店后清点员工限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"关店后清点所需人数公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            const rules1 = {\r\n              ruleTitle: \"关店后清点所需时间\",\r\n              ruleValue: json.after,\r\n            };\r\n            this.tableData.unshift(rules1);\r\n            console.log(datass.data);\r\n          });\r\n          // this.reload();\r\n        }\r\n      }\r\n    },\r\n\r\n    getCloseshopRules() {\r\n      getCloseshopRule().then((datas) => {\r\n        this.tableData.ruleId = datas.data[0].ruleTitle;\r\n        console.log(datas.data);\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.el-link {\r\n  margin-left: 17px;\r\n}\r\n\r\n.rules {\r\n  .title {\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n  .rulesList {\r\n    margin-top: 20px;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}