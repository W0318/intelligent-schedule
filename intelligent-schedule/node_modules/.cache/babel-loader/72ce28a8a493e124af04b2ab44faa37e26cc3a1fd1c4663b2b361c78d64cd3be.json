{"ast":null,"code":"import { ref } from 'vue';\nimport moment from \"moment\";\nexport default {\n  __name: 'DayDrag',\n  props: {\n    dayData: Array,\n    week_day: String,\n    viewValue: String,\n    loading: Boolean,\n    current: typeof moment(),\n    timesDay: Array\n  },\n  emits: ['emitDayData', 'handleClickTd', 'showAddView', 'message'],\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n    const svg = `\n        <path class=\"path\" d=\"\n          M 30 15\n          L 28 17\n          M 25.61 25.61\n          A 15 15, 0, 0, 1, 15 30\n          A 15 15, 0, 1, 1, 27.99 7.5\n          L 15 15\n        \" style=\"stroke-width: 4px; fill: rgba(0, 0, 0, 0)\"/>\n      `;\n\n    //是否可拖拽drag，拖拽起点dragging，拖拽终点ending\n    const drag = ref(false);\n    const ending = ref(null);\n    const dragging = ref(null);\n\n    //按日查看拖拽\n    const handleDragStart = (e, row, col) => {\n      // console.log(row, col);\n      dragging.value = [row, col];\n    };\n    const handleDragEnd = e => {\n      if (ending.value[0] === dragging.value[0] && ending.value[1] === dragging.value[1]) {\n        return;\n      }\n      if (dragging.value[1] === 'time' || ending.value[1] === 'time') return;\n      var newData = [...props.dayData];\n      var flag = false;\n      var start = newData[dragging.value[0]][0][dragging.value[1]];\n      var end = newData[ending.value[0]][0][ending.value[1]];\n      props.dayData[dragging.value[0]].map(value => {\n        if (flag === true) return;\n        if (JSON.stringify(value[0]) !== '{}' && value[0].employeeId !== null) {\n          if (JSON.stringify(end) !== '{}' && end.employeeId !== null && value[0].employeeId === end.employeeId) {\n            flag = true;\n            return;\n          }\n        }\n      });\n      props.dayData[ending.value[0]].map(value => {\n        if (flag === true) return;\n        if (JSON.stringify(value[0]) !== '{}' && value[0].employeeId !== null) {\n          if (JSON.stringify(start) !== '{}' && start.employeeId !== null && value[0].employeeId === start.employeeId) {\n            flag = true;\n            return;\n          }\n        }\n      });\n      if (flag === true) {\n        emit('message', '不能给同一个员工分配同一时间段的工作');\n        return;\n      }\n      if (dragging.value[0] === ending.value[0]) {\n        let item = [...newData[dragging.value[0]]];\n        let temp = item[0][dragging.value[1]];\n        item[0][dragging.value[1]] = item[0][ending.value[1]];\n        item[0][ending.value[1]] = temp;\n        newData[dragging.value[0]] = [...item];\n      } else {\n        let item1 = [...newData[dragging.value[0]]];\n        let item2 = [...newData[ending.value[0]]];\n        let temp = item1[0][dragging.value[1]];\n        item1[0][dragging.value[1]] = item2[0][ending.value[1]];\n        item2[0][ending.value[1]] = temp;\n        newData[dragging.value[0]] = [...item1];\n        newData[ending.value[0]] = [...item2];\n      }\n      console.log([...newData]);\n      emit('emitDayData', [...newData]);\n      dragging.value = null;\n      ending.value = null;\n    };\n    const handleDragOver = e => {\n      e.dataTransfer.dropEffect = \"move\";\n    };\n    const handleDragEnter = (e, row, col) => {\n      // console.log(row, col);\n      e.dataTransfer.effectAllowed = \"move\";\n      ending.value = [row, col];\n    };\n    const initDrag = () => {\n      drag.value = false;\n    };\n    const dayEdit = () => {\n      drag.value = drag.value === true ? false : true;\n    };\n    expose({\n      dayEdit,\n      initDrag\n    });\n    const __returned__ = {\n      props,\n      emit,\n      svg,\n      drag,\n      ending,\n      dragging,\n      handleDragStart,\n      handleDragEnd,\n      handleDragOver,\n      handleDragEnter,\n      initDrag,\n      dayEdit,\n      ref,\n      get moment() {\n        return moment;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","moment","svg","drag","ending","dragging","handleDragStart","e","row","col","value","handleDragEnd","newData","props","dayData","flag","start","end","map","JSON","stringify","employeeId","emit","item","temp","item1","item2","console","log","handleDragOver","dataTransfer","dropEffect","handleDragEnter","effectAllowed","initDrag","dayEdit","expose"],"sources":["E:/work/vue/schedule/intelligent-schedule/src/components/DayDrag.vue"],"sourcesContent":["<template>\r\n    <table class=\"table-out\">\r\n        <tbody v-loading=\"loading\" element-loading-text=\"Loading...\" :element-loading-spinner=\"svg\"\r\n            element-loading-svg-view-box=\"-10, -10, 50, 50\" element-loading-background=\"rgba(130, 130, 130, 0.7)\">\r\n            <tr v-for='(row, index1) in dayData' class=\"tr-out\">\r\n                <td id=\"td-time\" class=\"td-out\" style=\"background-color: #e3e3e3;\" :title=\"row[1]\">\r\n                    {{row[1]}}\r\n                </td>\r\n                <template v-for='(item, index2) in row[0]'>\r\n                    <td class=\"td-out td\" :class=\"drag === true ? 'move-day' : null\"\r\n                        :id=\"'td' + week_day + index1 + '-' + index2\" :title=\"(item.employeeId !== null && JSON.stringify(item) !== '{}') ?\r\n                            (item.employeeName + ' ' + item.position) : null\"\r\n                        @click=\"drag === false ? emit('handleClickTd', index1, index2) : null\"\r\n                        :draggable=\"drag === true ? true : false\" @dragstart=\"handleDragStart($event, index1, index2)\"\r\n                        @dragover.prevent=\"handleDragOver($event)\" @dragenter=\"handleDragEnter($event, index1, index2)\"\r\n                        @dragend=\"handleDragEnd($event)\">\r\n                        <div v-if=\"item.employeeId !== null && JSON.stringify(item) !== '{}'\">\r\n                            <span v-if=\"viewValue === '全部查看'\">\r\n                                {{ item.employeeName + ' ' + item.position }}\r\n                            </span>\r\n                            <span v-else-if=\"viewValue === '按岗位分组'\">{{ item.position }}</span>\r\n                            <span v-else>{{ item.employeeName }}</span>\r\n                        </div>\r\n                        <el-icon v-else-if=\"drag === true\" :size=\"22\" class=\"icon-add\"\r\n                            @click=\"emit('showAddView', [], index1, index2)\">\r\n                            <CirclePlus />\r\n                        </el-icon>\r\n                    </td>\r\n                </template>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport moment from \"moment\";\r\n\r\nconst props = defineProps({\r\n    dayData: Array,\r\n    week_day: String,\r\n    viewValue: String,\r\n    loading: Boolean,\r\n    current: typeof (moment()),\r\n    timesDay: Array\r\n});\r\nconst emit = defineEmits(['emitDayData', 'handleClickTd', 'showAddView', 'message']);\r\n\r\nconst svg = `\r\n        <path class=\"path\" d=\"\r\n          M 30 15\r\n          L 28 17\r\n          M 25.61 25.61\r\n          A 15 15, 0, 0, 1, 15 30\r\n          A 15 15, 0, 1, 1, 27.99 7.5\r\n          L 15 15\r\n        \" style=\"stroke-width: 4px; fill: rgba(0, 0, 0, 0)\"/>\r\n      `\r\n\r\n//是否可拖拽drag，拖拽起点dragging，拖拽终点ending\r\nconst drag = ref(false);\r\nconst ending = ref(null);\r\nconst dragging = ref(null);\r\n\r\n//按日查看拖拽\r\nconst handleDragStart = (e, row, col) => {\r\n    // console.log(row, col);\r\n    dragging.value = [row, col];\r\n}\r\nconst handleDragEnd = (e) => {\r\n    if (ending.value[0] === dragging.value[0] &&\r\n        ending.value[1] === dragging.value[1]) {\r\n        return;\r\n    }\r\n    if (dragging.value[1] === 'time' || ending.value[1] === 'time')\r\n        return;\r\n\r\n    var newData = [...props.dayData];\r\n    var flag = false;\r\n    var start = newData[dragging.value[0]][0][dragging.value[1]];\r\n    var end = newData[ending.value[0]][0][ending.value[1]];\r\n    props.dayData[dragging.value[0]].map(value => {\r\n        if (flag === true) return;\r\n        if (JSON.stringify(value[0]) !== '{}' && value[0].employeeId !== null) {\r\n            if (JSON.stringify(end) !== '{}' && end.employeeId !== null && value[0].employeeId === end.employeeId) {\r\n                flag = true;\r\n                return;\r\n            }\r\n        }\r\n    });\r\n    props.dayData[ending.value[0]].map(value => {\r\n        if (flag === true) return;\r\n        if (JSON.stringify(value[0]) !== '{}' && value[0].employeeId !== null) {\r\n            if (JSON.stringify(start) !== '{}' && start.employeeId !== null && value[0].employeeId === start.employeeId) {\r\n                flag = true;\r\n                return;\r\n            }\r\n        }\r\n    });\r\n    if (flag === true) {\r\n        emit('message', '不能给同一个员工分配同一时间段的工作');\r\n        return;\r\n    }\r\n\r\n    if (dragging.value[0] === ending.value[0]) {\r\n        let item = [...newData[dragging.value[0]]];\r\n        let temp = item[0][dragging.value[1]];\r\n        item[0][dragging.value[1]] = item[0][ending.value[1]];\r\n        item[0][ending.value[1]] = temp;\r\n\r\n        newData[dragging.value[0]] = [...item];\r\n    }\r\n    else {\r\n        let item1 = [...newData[dragging.value[0]]];\r\n        let item2 = [...newData[ending.value[0]]];\r\n        let temp = item1[0][dragging.value[1]];\r\n        item1[0][dragging.value[1]] = item2[0][ending.value[1]];\r\n        item2[0][ending.value[1]] = temp;\r\n\r\n        newData[dragging.value[0]] = [...item1];\r\n        newData[ending.value[0]] = [...item2];\r\n    }\r\n\r\n    console.log([...newData])\r\n    emit('emitDayData', [...newData]);\r\n    dragging.value = null;\r\n    ending.value = null;\r\n}\r\nconst handleDragOver = (e) => {\r\n    e.dataTransfer.dropEffect = \"move\";\r\n}\r\nconst handleDragEnter = (e, row, col) => {\r\n    // console.log(row, col);\r\n    e.dataTransfer.effectAllowed = \"move\";\r\n    ending.value = [row, col];\r\n}\r\n\r\nconst initDrag = () => {\r\n    drag.value = false;\r\n}\r\n\r\nconst dayEdit = () => {\r\n    drag.value = (drag.value === true ? false : true);\r\n}\r\ndefineExpose({\r\n    dayEdit,\r\n    initDrag\r\n})\r\n</script>\r\n\r\n<style lang=\"less\"></style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}