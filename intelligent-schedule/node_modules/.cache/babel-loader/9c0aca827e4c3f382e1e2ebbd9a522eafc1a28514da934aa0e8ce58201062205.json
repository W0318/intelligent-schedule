{"ast":null,"code":"import \"core-js/modules/es.array.unshift.js\";\nimport { getOpenshopRule, updateOpenshop, getOpenByStoreId, insertOpen, getAllRule, updateOpenByStoreId } from \"@/api\";\nexport default {\n  inject: [\"reload\"],\n  name: \"OpenShop\",\n  data() {\n    return {\n      rulenamee: \"\",\n      rulevaluee: \"\",\n      label111: -1,\n      //修改通用规则则为0，用通用规则但是分店则为1\n      label000: 0,\n      lengthh: 0,\n      tableData: [],\n      tableDatas: {\n        ruleTitle: \"\",\n        ruleValue: \"\"\n      },\n      tableData1: [],\n      tableDatas1: {\n        ruleTitle: \"\",\n        ruleValue: \"\"\n      },\n      addDialogVisible: false,\n      NoDelete: false,\n      NoDelete1: false,\n      Noemptyy: false,\n      addForm: {\n        ruleName: \"\",\n        ruleContent: \"\"\n      }\n    };\n  },\n  mounted() {\n    //获取通用规则\n    this.label111 = sessionStorage.getItem(\"label111\");\n    //不是总门店\n    if (this.label111 != -1) {\n      getOpenByStoreId(this.label111).then(datas => {\n        //没有自己的规则就用通用规则\n        if (datas.data.length == 0) {\n          getOpenshopRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"开店前准备所需人数公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            const rules1 = {\n              ruleTitle: \"开店前准备所需时间\",\n              ruleValue: json.before\n            };\n            this.tableData.unshift(rules1);\n            console.log(datas.data);\n            this.label000 = 1;\n          });\n          //有规则但都是空的，就显示公用规则\n        } else if (datas.data[0].ruleValue == '{\"before\": \"\", \"formula\": \"\", \"position\": \"\"}') {\n          getOpenshopRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"开店前准备所需人数公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            const rules1 = {\n              ruleTitle: \"开店前准备所需时间\",\n              ruleValue: json.before\n            };\n            this.tableData.unshift(rules1);\n            console.log(datas.data);\n          });\n        } else {\n          this.tableData = datas.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.position;\n          this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n          const rules = {\n            ruleTitle: \"开店前准备所需人数公式\",\n            ruleValue: json.formula\n          };\n          this.tableData.unshift(rules);\n          const rules1 = {\n            ruleTitle: \"开店前准备所需时间\",\n            ruleValue: json.before\n          };\n          this.tableData.unshift(rules1);\n          console.log(datas.data);\n        }\n      });\n    } else if (this.label111 == -1) {\n      getOpenshopRule().then(datas => {\n        this.tableData = datas.data;\n        let json = JSON.parse(this.tableData[0].ruleValue);\n        this.tableData[0].ruleValue = json.position;\n        this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n        const rules = {\n          ruleTitle: \"开店前准备所需人数公式\",\n          ruleValue: json.formula\n        };\n        this.tableData.unshift(rules);\n        const rules1 = {\n          ruleTitle: \"开店前准备所需时间\",\n          ruleValue: json.before\n        };\n        this.tableData.unshift(rules1);\n        console.log(datas.data);\n      });\n    }\n  },\n  methods: {\n    handleEdit(index, row) {\n      getAllRule().then(datas => {\n        // console.log(datas.data.length);\n        console.log(\"label000:\" + this.label000);\n        console.log(\"label111:\" + this.label111);\n      });\n      this.addDialogVisible = true;\n      this.rulenamee = this.tableData[index].ruleTitle;\n      // console.log(this.rulenamee);\n      this.rulevaluee = this.tableData[index].ruleValue;\n      // console.log(this.rulevaluee);\n    },\n\n    //删除\n    async handleDelete(index, row) {\n      this.rulenamee = this.tableData[index].ruleTitle;\n      //是分店有独立规则则编辑为\"\"（update\n      if (this.label111 != -1 && this.label000 == 0) {\n        if (this.rulenamee == \"开店前准备所需时间\") {\n          await getOpenshopRule().then(datass => {\n            this.tableData1 = datass.data;\n            console.log(this.tableData1);\n            let json = JSON.parse(this.tableData1[0].ruleValue);\n            console.log(json.before);\n            this.sstr = '{\"before\": ' + json.before + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n            console.log(this.sstr);\n          });\n        } else if (this.rulenamee == \"开店前准备所需人数公式\") {\n          this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n          console.log(this.sstr);\n        } else {\n          this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"\"}';\n          console.log(this.sstr);\n        }\n        console.log(this.sstr);\n        await updateOpenByStoreId(this.label111, this.sstr);\n        this.addDialogVisible = false;\n        await getOpenByStoreId(this.label111).then(datass => {\n          this.tableData = datass.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.position;\n          this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n          const rules = {\n            ruleTitle: \"开店前准备所需人数公式\",\n            ruleValue: json.formula\n          };\n          this.tableData.unshift(rules);\n          const rules1 = {\n            ruleTitle: \"开店前准备所需时间\",\n            ruleValue: json.before\n          };\n          this.tableData.unshift(rules1);\n          console.log(datass.data);\n        });\n      } else if (this.label111 == -1) {\n        this.NoDelete = true;\n      } else {\n        this.NoDelete1 = true;\n      }\n    },\n    //点击确认编辑button确认编辑规则\n    async handelUpdate() {\n      if (this.rulevaluee == \"\") {\n        this.Noemptyy = true;\n      } else {\n        //是分店\n        if (this.label111 != -1) {\n          //分店无独立规则则插入一条新规则\n          if (this.label000 == 1) {\n            if (this.rulenamee == \"开店前准备所需时间\") {\n              this.sstr = '{\"before\": ' + this.rulevaluee + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else if (this.rulenamee == \"开店前准备所需人数公式\") {\n              this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            getAllRule().then(async datas => {\n              this.lengthh = datas.data.length + 1;\n              this.lengthh = this.lengthh.toString();\n              console.log(this.lengthh);\n              console.log(this.label111);\n              await insertOpen(this.lengthh, this.label111, this.sstr);\n              this.addDialogVisible = false;\n              await getOpenByStoreId(this.label111).then(datass => {\n                this.tableData = datass.data;\n                let json = JSON.parse(this.tableData[0].ruleValue);\n                this.tableData[0].ruleValue = json.position;\n                this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n                const rules = {\n                  ruleTitle: \"开店前准备所需人数公式\",\n                  ruleValue: json.formula\n                };\n                this.tableData.unshift(rules);\n                const rules1 = {\n                  ruleTitle: \"开店前准备所需时间\",\n                  ruleValue: json.before\n                };\n                this.tableData.unshift(rules1);\n                console.log(datass.data);\n              });\n              // this.reload();\n            });\n          }\n          //分店有独立规则则进行编辑（update\n          else {\n            if (this.rulenamee == \"开店前准备所需时间\") {\n              this.sstr = '{\"before\": ' + this.rulevaluee + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else if (this.rulenamee == \"开店前准备所需人数公式\") {\n              this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            await updateOpenByStoreId(this.label111, this.sstr);\n            this.addDialogVisible = false;\n            await getOpenByStoreId(this.label111).then(datass => {\n              this.tableData = datass.data;\n              let json = JSON.parse(this.tableData[0].ruleValue);\n              this.tableData[0].ruleValue = json.position;\n              this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n              const rules = {\n                ruleTitle: \"开店前准备所需人数公式\",\n                ruleValue: json.formula\n              };\n              this.tableData.unshift(rules);\n              const rules1 = {\n                ruleTitle: \"开店前准备所需时间\",\n                ruleValue: json.before\n              };\n              this.tableData.unshift(rules1);\n              console.log(datass.data);\n            });\n            // this.reload();\n          }\n        }\n        //不是分店\n        else {\n          if (this.rulenamee == \"开店前准备所需时间\") {\n            this.sstr = '{\"before\": ' + this.rulevaluee + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n            console.log(this.sstr);\n          } else if (this.rulenamee == \"开店前准备所需人数公式\") {\n            this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[2].ruleValue + '\"}';\n            console.log(this.sstr);\n          } else {\n            this.sstr = '{\"before\": ' + this.tableData[0].ruleValue + ', \"formula\": \"' + this.tableData[1].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n            console.log(this.sstr);\n          }\n          console.log(this.rulevaluee);\n          await updateOpenshop(this.sstr);\n          this.addDialogVisible = false;\n          await getOpenshopRule().then(datass => {\n            this.tableData = datass.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"开店前准备所需人数公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            const rules1 = {\n              ruleTitle: \"开店前准备所需时间\",\n              ruleValue: json.before\n            };\n            this.tableData.unshift(rules1);\n            console.log(datass.data);\n          });\n          // this.reload();\n        }\n      }\n    },\n\n    getOpenshopRules() {\n      getOpenshopRule().then(datas => {\n        this.tableData.ruleId = datas.data[0].ruleTitle;\n        console.log(datas.data);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["getOpenshopRule","updateOpenshop","getOpenByStoreId","insertOpen","getAllRule","updateOpenByStoreId","inject","name","data","rulenamee","rulevaluee","label111","label000","lengthh","tableData","tableDatas","ruleTitle","ruleValue","tableData1","tableDatas1","addDialogVisible","NoDelete","NoDelete1","Noemptyy","addForm","ruleName","ruleContent","mounted","sessionStorage","getItem","then","datas","length","json","JSON","parse","position","rules","formula","unshift","rules1","before","console","log","methods","handleEdit","index","row","handleDelete","datass","sstr","handelUpdate","toString","getOpenshopRules","ruleId"],"sourceRoot":"","sources":["E:\\work\\vue\\schedule\\intelligent-schedule\\src\\views\\ShiftSchedule\\components\\OpenShopRules.vue"],"sourcesContent":["<template>\r\n  <div class=\"rules\">\r\n    <div class=\"title\">\r\n      <h2>开店规则</h2>\r\n    </div>\r\n    <div class=\"rulesList\">\r\n      <el-table :data=\"tableData\" style=\"width: 100%\" stripe>\r\n        <el-table-column label=\"\" prop=\"ruleTitle\"> </el-table-column>\r\n        <el-table-column label=\"\" prop=\"ruleValue\"> </el-table-column>\r\n        <el-table-column label=\"\">\r\n          <template v-slot=\"scope\">\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"primary\"\r\n              @click=\"handleEdit(scope.$index, scope.row)\"\r\n            >\r\n              编辑\r\n            </el-link>\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"danger\"\r\n              @click=\"handleDelete(scope.$index, scope.row)\"\r\n              >删除</el-link\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <!-- 编辑规则对话框 -->\r\n    <el-dialog v-model=\"addDialogVisible\" title=\"编辑规则\" width=\"30%\">\r\n      <el-form :model=\"addForm\">\r\n        <el-form-item :label=\"this.rulenamee\" label-width=\"66%\"> </el-form-item>\r\n        <el-form-item label=\"规则内容：\" prop=\"rulevaluee\">\r\n          <el-input\r\n            v-model=\"this.rulevaluee\"\r\n            placeholder=\"请输入规则内容\"\r\n            clearable\r\n            :style=\"{ width: '100%' }\"\r\n          >\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handelUpdate\"> 确定 </el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm\">\r\n        <el-form-item label=\"无法删除通用规则\" label-width=\"66%\" prop=\"nono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete1\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm1\">\r\n        <el-form-item\r\n          label=\"该分店无独立规则，无法进行删除操作\"\r\n          label-width=\"90%\"\r\n          prop=\"nono\"\r\n        >\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete1 = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"Noemptyy\" title=\"不能为空\" width=\"30%\">\r\n      <el-form :model=\"Noempty\">\r\n        <el-form-item label=\"输入值不能为空\" label-width=\"66%\" prop=\"nonono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"Noemptyy = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getOpenshopRule,\r\n  updateOpenshop,\r\n  getOpenByStoreId,\r\n  insertOpen,\r\n  getAllRule,\r\n  updateOpenByStoreId,\r\n} from \"@/api\";\r\n\r\nexport default {\r\n  inject: [\"reload\"],\r\n  name: \"OpenShop\",\r\n  data() {\r\n    return {\r\n      rulenamee: \"\",\r\n      rulevaluee: \"\",\r\n      label111: -1,\r\n      //修改通用规则则为0，用通用规则但是分店则为1\r\n      label000: 0,\r\n      lengthh: 0,\r\n\r\n      tableData: [],\r\n      tableDatas: {\r\n        ruleTitle: \"\",\r\n        ruleValue: \"\",\r\n      },\r\n\r\n      tableData1: [],\r\n      tableDatas1: {\r\n        ruleTitle: \"\",\r\n        ruleValue: \"\",\r\n      },\r\n\r\n      addDialogVisible: false,\r\n      NoDelete: false,\r\n      NoDelete1: false,\r\n      Noemptyy: false,\r\n      addForm: {\r\n        ruleName: \"\",\r\n        ruleContent: \"\",\r\n      },\r\n    };\r\n  },\r\n\r\n  mounted() {\r\n    //获取通用规则\r\n    this.label111 = sessionStorage.getItem(\"label111\");\r\n    //不是总门店\r\n    if (this.label111 != -1) {\r\n      getOpenByStoreId(this.label111).then((datas) => {\r\n        //没有自己的规则就用通用规则\r\n        if (datas.data.length == 0) {\r\n          getOpenshopRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"开店前准备所需人数公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            const rules1 = {\r\n              ruleTitle: \"开店前准备所需时间\",\r\n              ruleValue: json.before,\r\n            };\r\n            this.tableData.unshift(rules1);\r\n            console.log(datas.data);\r\n            this.label000 = 1;\r\n          });\r\n          //有规则但都是空的，就显示公用规则\r\n        } else if (\r\n          datas.data[0].ruleValue ==\r\n          '{\"before\": \"\", \"formula\": \"\", \"position\": \"\"}'\r\n        ) {\r\n          getOpenshopRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"开店前准备所需人数公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            const rules1 = {\r\n              ruleTitle: \"开店前准备所需时间\",\r\n              ruleValue: json.before,\r\n            };\r\n            this.tableData.unshift(rules1);\r\n            console.log(datas.data);\r\n          });\r\n        } else {\r\n          this.tableData = datas.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.position;\r\n          this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n          const rules = {\r\n            ruleTitle: \"开店前准备所需人数公式\",\r\n            ruleValue: json.formula,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          const rules1 = {\r\n            ruleTitle: \"开店前准备所需时间\",\r\n            ruleValue: json.before,\r\n          };\r\n          this.tableData.unshift(rules1);\r\n          console.log(datas.data);\r\n        }\r\n      });\r\n    } else if (this.label111 == -1) {\r\n      getOpenshopRule().then((datas) => {\r\n        this.tableData = datas.data;\r\n        let json = JSON.parse(this.tableData[0].ruleValue);\r\n        this.tableData[0].ruleValue = json.position;\r\n        this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n        const rules = {\r\n          ruleTitle: \"开店前准备所需人数公式\",\r\n          ruleValue: json.formula,\r\n        };\r\n        this.tableData.unshift(rules);\r\n        const rules1 = {\r\n          ruleTitle: \"开店前准备所需时间\",\r\n          ruleValue: json.before,\r\n        };\r\n        this.tableData.unshift(rules1);\r\n        console.log(datas.data);\r\n      });\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    handleEdit(index, row) {\r\n      getAllRule().then((datas) => {\r\n        // console.log(datas.data.length);\r\n        console.log(\"label000:\" + this.label000);\r\n        console.log(\"label111:\" + this.label111);\r\n      });\r\n      this.addDialogVisible = true;\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      // console.log(this.rulenamee);\r\n      this.rulevaluee = this.tableData[index].ruleValue;\r\n      // console.log(this.rulevaluee);\r\n    },\r\n\r\n    //删除\r\n    async handleDelete(index, row) {\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      //是分店有独立规则则编辑为\"\"（update\r\n      if (this.label111 != -1 && this.label000 == 0) {\r\n        if (this.rulenamee == \"开店前准备所需时间\") {\r\n          await getOpenshopRule().then((datass) => {\r\n            this.tableData1 = datass.data;\r\n            console.log(this.tableData1);\r\n            let json = JSON.parse(this.tableData1[0].ruleValue);\r\n            console.log(json.before);\r\n            this.sstr =\r\n              '{\"before\": ' +\r\n              json.before +\r\n              ', \"formula\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.tableData[2].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          });\r\n        } else if (this.rulenamee == \"开店前准备所需人数公式\") {\r\n          this.sstr =\r\n            '{\"before\": ' +\r\n            this.tableData[0].ruleValue +\r\n            ', \"formula\": \"\", \"position\": \"' +\r\n            this.tableData[2].ruleValue +\r\n            '\"}';\r\n          console.log(this.sstr);\r\n        } else {\r\n          this.sstr =\r\n            '{\"before\": ' +\r\n            this.tableData[0].ruleValue +\r\n            ', \"formula\": \"' +\r\n            this.tableData[1].ruleValue +\r\n            '\", \"position\": \"\"}';\r\n          console.log(this.sstr);\r\n        }\r\n        console.log(this.sstr);\r\n        await updateOpenByStoreId(this.label111, this.sstr);\r\n        this.addDialogVisible = false;\r\n        await getOpenByStoreId(this.label111).then((datass) => {\r\n          this.tableData = datass.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.position;\r\n          this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n          const rules = {\r\n            ruleTitle: \"开店前准备所需人数公式\",\r\n            ruleValue: json.formula,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          const rules1 = {\r\n            ruleTitle: \"开店前准备所需时间\",\r\n            ruleValue: json.before,\r\n          };\r\n          this.tableData.unshift(rules1);\r\n          console.log(datass.data);\r\n        });\r\n      } else if (this.label111 == -1) {\r\n        this.NoDelete = true;\r\n      } else {\r\n        this.NoDelete1 = true;\r\n      }\r\n    },\r\n\r\n    //点击确认编辑button确认编辑规则\r\n    async handelUpdate() {\r\n      if (this.rulevaluee == \"\") {\r\n        this.Noemptyy = true;\r\n      } else {\r\n        //是分店\r\n        if (this.label111 != -1) {\r\n          //分店无独立规则则插入一条新规则\r\n          if (this.label000 == 1) {\r\n            if (this.rulenamee == \"开店前准备所需时间\") {\r\n              this.sstr =\r\n                '{\"before\": ' +\r\n                this.rulevaluee +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else if (this.rulenamee == \"开店前准备所需人数公式\") {\r\n              this.sstr =\r\n                '{\"before\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.rulevaluee +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else {\r\n              this.sstr =\r\n                '{\"before\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.rulevaluee +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            }\r\n            getAllRule().then(async (datas) => {\r\n              this.lengthh = datas.data.length + 1;\r\n              this.lengthh = this.lengthh.toString();\r\n              console.log(this.lengthh);\r\n              console.log(this.label111);\r\n              await insertOpen(this.lengthh, this.label111, this.sstr);\r\n              this.addDialogVisible = false;\r\n\r\n              await getOpenByStoreId(this.label111).then((datass) => {\r\n                this.tableData = datass.data;\r\n                let json = JSON.parse(this.tableData[0].ruleValue);\r\n                this.tableData[0].ruleValue = json.position;\r\n                this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n                const rules = {\r\n                  ruleTitle: \"开店前准备所需人数公式\",\r\n                  ruleValue: json.formula,\r\n                };\r\n                this.tableData.unshift(rules);\r\n                const rules1 = {\r\n                  ruleTitle: \"开店前准备所需时间\",\r\n                  ruleValue: json.before,\r\n                };\r\n                this.tableData.unshift(rules1);\r\n                console.log(datass.data);\r\n              });\r\n              // this.reload();\r\n            });\r\n          }\r\n          //分店有独立规则则进行编辑（update\r\n          else {\r\n            if (this.rulenamee == \"开店前准备所需时间\") {\r\n              this.sstr =\r\n                '{\"before\": ' +\r\n                this.rulevaluee +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else if (this.rulenamee == \"开店前准备所需人数公式\") {\r\n              this.sstr =\r\n                '{\"before\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.rulevaluee +\r\n                '\", \"position\": \"' +\r\n                this.tableData[2].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else {\r\n              this.sstr =\r\n                '{\"before\": ' +\r\n                this.tableData[0].ruleValue +\r\n                ', \"formula\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.rulevaluee +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            }\r\n            await updateOpenByStoreId(this.label111, this.sstr);\r\n            this.addDialogVisible = false;\r\n            await getOpenByStoreId(this.label111).then((datass) => {\r\n              this.tableData = datass.data;\r\n              let json = JSON.parse(this.tableData[0].ruleValue);\r\n              this.tableData[0].ruleValue = json.position;\r\n              this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n              const rules = {\r\n                ruleTitle: \"开店前准备所需人数公式\",\r\n                ruleValue: json.formula,\r\n              };\r\n              this.tableData.unshift(rules);\r\n              const rules1 = {\r\n                ruleTitle: \"开店前准备所需时间\",\r\n                ruleValue: json.before,\r\n              };\r\n              this.tableData.unshift(rules1);\r\n              console.log(datass.data);\r\n            });\r\n            // this.reload();\r\n          }\r\n        }\r\n        //不是分店\r\n        else {\r\n          if (this.rulenamee == \"开店前准备所需时间\") {\r\n            this.sstr =\r\n              '{\"before\": ' +\r\n              this.rulevaluee +\r\n              ', \"formula\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.tableData[2].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else if (this.rulenamee == \"开店前准备所需人数公式\") {\r\n            this.sstr =\r\n              '{\"before\": ' +\r\n              this.tableData[0].ruleValue +\r\n              ', \"formula\": \"' +\r\n              this.rulevaluee +\r\n              '\", \"position\": \"' +\r\n              this.tableData[2].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else {\r\n            this.sstr =\r\n              '{\"before\": ' +\r\n              this.tableData[0].ruleValue +\r\n              ', \"formula\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.rulevaluee +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          }\r\n          console.log(this.rulevaluee);\r\n          await updateOpenshop(this.sstr);\r\n          this.addDialogVisible = false;\r\n\r\n          await getOpenshopRule().then((datass) => {\r\n            this.tableData = datass.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"开店前准备员工限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"开店前准备所需人数公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            const rules1 = {\r\n              ruleTitle: \"开店前准备所需时间\",\r\n              ruleValue: json.before,\r\n            };\r\n            this.tableData.unshift(rules1);\r\n            console.log(datass.data);\r\n          });\r\n          // this.reload();\r\n        }\r\n      }\r\n    },\r\n\r\n    getOpenshopRules() {\r\n      getOpenshopRule().then((datas) => {\r\n        this.tableData.ruleId = datas.data[0].ruleTitle;\r\n        console.log(datas.data);\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.el-link {\r\n  margin-left: 17px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}