{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createBlock as _createBlock, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, resolveDirective as _resolveDirective, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"table-out\"\n};\nconst _hoisted_2 = {\n  class: \"item\"\n};\nconst _hoisted_3 = {\n  class: \"tr-out\"\n};\nconst _hoisted_4 = [\"title\"];\nconst _hoisted_5 = [\"id\", \"onClick\"];\nconst _hoisted_6 = [\"title\"];\nconst _hoisted_7 = {\n  key: 1\n};\nconst _hoisted_8 = {\n  key: 2\n};\nconst _hoisted_9 = {\n  key: 3\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_CircleClose = _resolveComponent(\"CircleClose\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_CirclePlus = _resolveComponent(\"CirclePlus\");\n  const _directive_loading = _resolveDirective(\"loading\");\n  return _openBlock(), _createElementBlock(\"table\", _hoisted_1, [_createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($props.table, (item, index) => {\n    return _openBlock(), _createElementBlock(\"th\", _hoisted_2, _toDisplayString(item), 1 /* TEXT */);\n  }), 256 /* UNKEYED_FRAGMENT */))])]), _withDirectives((_openBlock(), _createElementBlock(\"tbody\", {\n    \"element-loading-text\": \"Loading...\",\n    \"element-loading-spinner\": $setup.svg,\n    \"element-loading-svg-view-box\": \"-10, -10, 50, 50\",\n    \"element-loading-background\": \"rgba(130, 130, 130, 0.7)\"\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($props.tableData, (shifts, i) => {\n    return _openBlock(), _createElementBlock(\"tr\", _hoisted_3, [_createElementVNode(\"td\", {\n      class: \"td-out\",\n      title: shifts[0]\n    }, _toDisplayString(shifts[0]), 9 /* TEXT, PROPS */, _hoisted_4), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(shifts[1], (value, j) => {\n      return _openBlock(), _createElementBlock(\"td\", {\n        class: _normalizeClass([\"td-out td\", value[0] == null ? 'slash' : null]),\n        id: 'td' + $props.week_day + i + '-' + j,\n        onClick: $event => $setup.drag === false && value[0] != null ? $setup.emit('handleClickTd', i, j) : null\n      }, [value[0] != null ? (_openBlock(), _createBlock($setup[\"draggable\"], {\n        key: 0,\n        \"model-value\": value[0],\n        group: \"people\",\n        animation: \"300\",\n        \"item-key\": \"key\",\n        onStart: $event => $setup.startDrag($event, i, j),\n        onEnd: _cache[0] || (_cache[0] = $event => $setup.endDrag($event)),\n        onDragenter: $event => $setup.enterDrag($event, i, j)\n      }, {\n        item: _withCtx(({\n          element,\n          index\n        }) => [_createElementVNode(\"div\", {\n          class: _normalizeClass([\"item\", $setup.drag === true ? 'move' : null]),\n          title: element.employeeName + ' ' + element.position\n        }, [$setup.drag === true ? (_openBlock(), _createBlock(_component_el_icon, {\n          key: 0,\n          size: 19,\n          class: \"icon-delete\",\n          onClick: $event => $setup.deleteItem(i, j, index)\n        }, {\n          default: _withCtx(() => [_createVNode(_component_CircleClose)]),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true), $props.viewValue === '全部查看' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_7, _toDisplayString(element.employeeName + ' ' + element.position), 1 /* TEXT */)) : $props.viewValue === '按岗位分组' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, _toDisplayString(element.position), 1 /* TEXT */)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_9, _toDisplayString(element.employeeName), 1 /* TEXT */))], 10 /* CLASS, PROPS */, _hoisted_6)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"model-value\", \"onStart\", \"onDragenter\"])) : _createCommentVNode(\"v-if\", true), $setup.drag === true && value[0] != null ? (_openBlock(), _createBlock(_component_el_icon, {\n        key: 1,\n        size: 22,\n        class: \"icon-add\",\n        onClick: $event => $setup.emit('showAddView', value[0], i, j)\n      }, {\n        default: _withCtx(() => [_createVNode(_component_CirclePlus)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true)], 10 /* CLASS, PROPS */, _hoisted_5);\n    }), 256 /* UNKEYED_FRAGMENT */))]);\n  }), 256 /* UNKEYED_FRAGMENT */))])), [[_directive_loading, $props.loading]])]);\n}","map":{"version":3,"mappings":";;EACSA,KAAK,EAAC;AAAW;;EAIZA,KAAK,EAAC;AAAM;;EAMiBA,KAAK,EAAC;AAAQ;;;;;;;;;;;;;;;;;;uBAVvDC,oBAyCQ,SAzCRC,UAyCQ,GAxCNC,oBAMQ,gBALNA,oBAIK,gCAHHF,oBAEWG,6BAFuBC,YAAK,GAArBC,IAAI,EAAEC,KAAK;yBAC3BN,oBAAgC,MAAhCO,UAAgC,mBAAZF,IAAI;uEAI9BL,oBAgCQ;IAhCmB,sBAAoB,EAAC,YAAY;IAAE,yBAAuB,EAAEQ,UAAG;IACxF,8BAA4B,EAAC,kBAAkB;IAAC,4BAA0B,EAAC;yBAC3ER,oBA6BKG,6BA7BqBC,gBAAS,GAAvBK,MAAM,EAAEC,CAAC;yBAArBV,oBA6BK,MA7BLW,UA6BK,GA5BHT,oBAEK;MAFDH,KAAK,EAAC,QAAQ;MAAEa,KAAK,EAAEH,MAAM;wBAC5BA,MAAM,2DAEXT,oBAwBWG,6BAxBoBM,MAAM,MAAnBI,KAAK,EAAEC,CAAC;2BACxBd,oBAsBK;QAtBDD,KAAK,mBAAC,WAAW,EAASc,KAAK;QAA+BE,EAAE,SAASX,eAAQ,GAAGM,CAAC,SAASI,CAAC;QAChGE,OAAK,YAAGR,WAAI,cAAcK,KAAK,cAAeL,WAAI,kBAAkBE,CAAC,EAAEI,CAAC;UACxDD,KAAK,6BAAtBI,aAeYT;;QAfwB,aAAW,EAAEK,KAAK;QAAKK,KAAK,EAAC,QAAQ;QAACC,SAAS,EAAC,KAAK;QAAC,UAAQ,EAAC,KAAK;QACrGC,OAAK,YAAEZ,gBAAS,CAACa,MAAM,EAAEX,CAAC,EAAEI,CAAC;QAAIQ,KAAG,sCAAEd,cAAO,CAACa,MAAM;QAAIE,WAAS,YAAEf,gBAAS,CAACa,MAAM,EAAEX,CAAC,EAAEI,CAAC;;QAC/ET,IAAI,WACb,CAUM;UAXWmB,OAAO;UAAElB;QAAK,OAC/BJ,oBAUM;UAVDH,KAAK,mBAAC,MAAM,EAAUS,WAAI;UAC5BI,KAAK,EAAEY,OAAO,CAACC,YAAY,SAASD,OAAO,CAACE;YAC9BlB,WAAI,2BAAnBS,aAEUU;;UAFqBC,IAAI,EAAE,EAAE;UAAE7B,KAAK,EAAC,aAAa;UAAEiB,OAAK,YAAER,iBAAU,CAACE,CAAC,EAAEI,CAAC,EAAER,KAAK;;4BACzF,MAAe,CAAfuB,aAAeC;;+FAEL1B,gBAAS,6BAArBJ,oBAEO,qCADFwB,OAAO,CAACC,YAAY,SAASD,OAAO,CAACE,QAAQ,oBAEjCtB,gBAAS,8BAA1BJ,oBAAqE,qCAA1BwB,OAAO,CAACE,QAAQ,mCAC3D1B,oBAA8C,qCAA9BwB,OAAO,CAACC,YAAY;;2HAI3BjB,WAAI,aAAaK,KAAK,6BAArCI,aAGUU;;QAHyCC,IAAI,EAAE,EAAE;QAAE7B,KAAK,EAAC,UAAU;QAC1EiB,OAAK,YAAER,WAAI,gBAAgBK,KAAK,KAAKH,CAAC,EAAEI,CAAC;;0BAC1C,MAAc,CAAde,aAAcE;;;;6DA3BN3B,cAAO","names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_Fragment","$props","item","index","_hoisted_2","$setup","shifts","i","_hoisted_3","title","value","j","id","onClick","_createBlock","group","animation","onStart","$event","onEnd","onDragenter","element","employeeName","position","_component_el_icon","size","_createVNode","_component_CircleClose","_component_CirclePlus"],"sourceRoot":"","sources":["E:\\work\\vue\\schedule\\intelligent-schedule\\src\\components\\WeekDrag.vue"],"sourcesContent":["<template>\r\n  <table class=\"table-out\">\r\n    <thead>\r\n      <tr>\r\n        <template v-for='(item, index) in table'>\r\n          <th class=\"item\">{{ item }}</th>\r\n        </template>\r\n      </tr>\r\n    </thead>\r\n    <tbody v-loading=\"loading\" element-loading-text=\"Loading...\" :element-loading-spinner=\"svg\"\r\n      element-loading-svg-view-box=\"-10, -10, 50, 50\" element-loading-background=\"rgba(130, 130, 130, 0.7)\">\r\n      <tr v-for='(shifts, i) in tableData' class=\"tr-out\">\r\n        <td class=\"td-out\" :title=\"shifts[0]\">\r\n          {{ shifts[0] }}\r\n        </td>\r\n        <template v-for=\"(value, j) in shifts[1]\">\r\n          <td class=\"td-out td\" :class=\"value[0] == null ? 'slash' : null\" :id=\"'td' + week_day + i + '-' + j\"\r\n            @click=\"(drag === false && value[0] != null) ? emit('handleClickTd', i, j) : null\">\r\n            <draggable v-if=\"value[0] != null\" :model-value=\"value[0]\" group=\"people\" animation=\"300\" item-key=\"key\"\r\n              @start=\"startDrag($event, i, j)\" @end=\"endDrag($event)\" @dragenter=\"enterDrag($event, i, j)\">\r\n              <template #item=\"{ element, index }\">\r\n                <div class=\"item\" :class=\"(drag === true) ? 'move' : null\"\r\n                  :title=\"element.employeeName + ' ' + element.position\">\r\n                  <el-icon v-if=\"drag === true\" :size=\"19\" class=\"icon-delete\" @click=\"deleteItem(i, j, index)\">\r\n                    <CircleClose />\r\n                  </el-icon>\r\n                  <span v-if=\"viewValue === '全部查看'\">\r\n                    {{ element.employeeName + ' ' + element.position }}\r\n                  </span>\r\n                  <span v-else-if=\"viewValue === '按岗位分组'\">{{ element.position }}</span>\r\n                  <span v-else>{{ element.employeeName }}</span>\r\n                </div>\r\n              </template>\r\n            </draggable>\r\n            <el-icon v-if=\"drag === true && value[0] != null\" :size=\"22\" class=\"icon-add\"\r\n              @click=\"emit('showAddView', value[0], i, j)\">\r\n              <CirclePlus />\r\n            </el-icon>\r\n          </td>\r\n        </template>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport draggable from 'vuedraggable';\r\n\r\nconst props = defineProps({\r\n  table: Object,\r\n  tableData: Array,\r\n  week_day: String,\r\n  viewValue: String,\r\n  loading: Boolean\r\n});\r\nconst emit = defineEmits(['emitTableData', 'handleClickTd', 'showAddView', 'message']);\r\n\r\nconsole.log(props.tableData)\r\n//加载数据\r\nconst svg = `\r\n        <path class=\"path\" d=\"\r\n          M 30 15\r\n          L 28 17\r\n          M 25.61 25.61\r\n          A 15 15, 0, 0, 1, 15 30\r\n          A 15 15, 0, 1, 1, 27.99 7.5\r\n          L 15 15\r\n        \" style=\"stroke-width: 4px; fill: rgba(0, 0, 0, 0)\"/>\r\n      `\r\n\r\n//是否可拖拽drag，拖拽起点dragging，拖拽终点ending\r\nconst drag = ref(false);\r\nconst ending = ref(null);\r\nconst dragging = ref(null);\r\n\r\n//开始拖拽、拖拽终点、结束拖拽\r\nconst startDrag = (e, index1, index2) => {\r\n  if (drag.value === false) return;\r\n  dragging.value = [index1, index2];\r\n  // console.log(index1, index2);\r\n}\r\nconst enterDrag = (e, index1, index2) => {\r\n  if (drag.value === false) return;\r\n  ending.value = [index1, index2];\r\n  // console.log(index1, index2);\r\n}\r\nconst endDrag = (e) => {\r\n  if (drag.value === false) return;\r\n  if (ending.value[0] === dragging.value[0] &&\r\n    ending.value[1] === dragging.value[1]) {\r\n    return;\r\n  }\r\n\r\n  var flag = false;\r\n  props.tableData[ending.value[0]][1][ending.value[1]][0].map((value) => {\r\n    if (value.employeeId === props.tableData[dragging.value[0]][1][dragging.value[1]][0][e.oldIndex].employeeId) {\r\n      flag = true;\r\n      return;\r\n    }\r\n  })\r\n  if (flag === true) {\r\n    emit('message', '不能给同一个员工分配同一时间段的工作');\r\n    return;\r\n  }\r\n\r\n  var newData = [...props.tableData];\r\n\r\n  if (dragging.value[0] === ending.value[0]) {\r\n    let item = [...newData[dragging.value[0]]];\r\n    item[1][ending.value[1]][0].push(item[1][dragging.value[1]][0][e.oldIndex]);\r\n    item[1][dragging.value[1]][0].splice(e.oldIndex, 1);\r\n\r\n    newData[dragging.value[0]] = [...item];\r\n  } else {\r\n    let item1 = [...newData[dragging.value[0]]];\r\n    let item2 = [...newData[ending.value[0]]];\r\n    item2[1][ending.value[1]][0].push(item1[1][dragging.value[1]][0][e.oldIndex]);\r\n    item1[1][dragging.value[1]][0].splice(e.oldIndex, 1);\r\n\r\n    newData[dragging.value[0]] = [...item1];\r\n    newData[ending.value[0]] = [...item2];\r\n  }\r\n\r\n  emit('emitTableData', [...newData]);\r\n}\r\n\r\n//删除员工\r\nconst deleteItem = (index1, index2, index) => {\r\n  console.log(index1, index2, index);\r\n\r\n  let newData = [...props.tableData];\r\n  let item = [...newData[index1]];\r\n\r\n  item[1][index2][0].splice(index, 1);\r\n  newData[index1] = [...item];\r\n\r\n  emit('emitTableData', [...newData]);\r\n}\r\n\r\nconst weekEdit = () => {\r\n  drag.value = (drag.value === true ? false : true);\r\n}\r\n\r\nconst initDrag = () => {\r\n  drag.value = false;\r\n}\r\n\r\ndefineExpose({\r\n  weekEdit,\r\n  initDrag\r\n})\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.table-out {\r\n  table-layout: fixed;\r\n  width: 100%;\r\n  text-align: center;\r\n  border-collapse: collapse;\r\n  border-spacing: 0;\r\n\r\n  thead tr th {\r\n    padding: 20px 15px;\r\n    font-weight: 500;\r\n    background: #e3e3e3;\r\n    transition: background .3s ease;\r\n    border: 1px solid #eee;\r\n\r\n    &:first-child {\r\n      border-top-left-radius: 5px;\r\n      border-left: none;\r\n      border-top: none;\r\n    }\r\n\r\n    &:last-child {\r\n      border-top-right-radius: 5px;\r\n      border-right: none;\r\n      border-top: none;\r\n    }\r\n  }\r\n\r\n  tbody .tr-out {\r\n    .td-out {\r\n      border: 1px solid #eee;\r\n      transition: background .3s;\r\n      overflow: hidden;\r\n      white-space: nowrap;\r\n      text-overflow: ellipsis;\r\n      padding: 10px;\r\n\r\n      .item {\r\n        padding: 3px 10px;\r\n        transition: background .3s;\r\n        overflow: hidden;\r\n        white-space: nowrap;\r\n        text-overflow: ellipsis;\r\n      }\r\n\r\n      .icon-delete {\r\n        margin-right: 5px;\r\n        vertical-align: middle;\r\n        color: #ff6b6b;\r\n        transition: all 0.5s;\r\n      }\r\n\r\n      .icon-delete:hover {\r\n        cursor: pointer;\r\n        transform: rotateZ(180deg);\r\n      }\r\n\r\n      .icon-add {\r\n        margin-top: 10px;\r\n        transition: all 0.5s;\r\n        color: #0a85ff;\r\n      }\r\n\r\n      .icon-add:hover {\r\n        cursor: pointer;\r\n        border: #0a85ff 1px solid;\r\n        border-radius: 10px;\r\n        padding: 5px;\r\n      }\r\n    }\r\n\r\n    .slash {\r\n      background: #fff url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxsaW5lIHgxPSIwIiB5MT0iMCIgeDI9IjEwMCUiIHkyPSIxMDAlIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=) no-repeat 100% center;\r\n    }\r\n\r\n    .slash:hover {\r\n      cursor: none;\r\n    }\r\n\r\n    .td:hover {\r\n      cursor: pointer;\r\n    }\r\n\r\n    .move {\r\n      margin: 2px;\r\n      padding: 10px;\r\n      background-color: #f1f1f1;\r\n      border-radius: 5px;\r\n    }\r\n\r\n    .move:hover {\r\n      background-color: #b6dbff;\r\n      cursor: move;\r\n    }\r\n\r\n    .move-day:hover {\r\n      background-color: #b6dbff;\r\n      cursor: move;\r\n    }\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}