{"ast":null,"code":"import \"core-js/modules/es.array.unshift.js\";\nimport { ref } from \"vue\";\nimport { ElMessageBox, rowProps } from \"element-plus\";\nimport { getClassesRule, updateClasses, getClassesByStoreId, insertClasses, getAllRule, updateClassesByStoreId } from \"@/api\";\nexport default {\n  inject: [\"reload\"],\n  name: \"Classes\",\n  data() {\n    return {\n      rulenamee: \"\",\n      rulevaluee: \"\",\n      label111: -1,\n      //修改通用规则则为0，用通用规则但是分店则为1\n      label000: 0,\n      lengthh: 0,\n      tableData: [],\n      tableDatas: {\n        ruleTitle: \"\",\n        ruleValue: \"\"\n      },\n      addDialogVisible: false,\n      NoDelete: false,\n      NoDelete1: false,\n      Noemptyy: false,\n      addForm: {\n        ruleName: \"\",\n        ruleContent: \"\"\n      }\n    };\n  },\n  mounted() {\n    //获取通用规则\n    this.label111 = sessionStorage.getItem(\"label111\");\n    console.log(this.label111);\n    //不是总门店\n    if (this.label111 != -1) {\n      getClassesByStoreId(this.label111).then(async datas => {\n        //没有自己的规则就用通用规则\n        if (datas.data.length == 0) {\n          getClassesRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"班次时间段\",\n              ruleValue: json.period\n            };\n            this.tableData.unshift(rules);\n            console.log(datas.data);\n            this.label000 = 1;\n          });\n        } else if (datas.data[0].ruleValue == '{\"period\": \"\", \"position\": \"\"}') {\n          getClassesRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"班次时间段\",\n              ruleValue: json.period\n            };\n            this.tableData.unshift(rules);\n            console.log(datas.data);\n          });\n        } else {\n          this.tableData = datas.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.position;\n          this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n          const rules = {\n            ruleTitle: \"班次时间段\",\n            ruleValue: json.period\n          };\n          this.tableData.unshift(rules);\n          console.log(datas.data);\n        }\n      });\n    } else if (this.label111 == -1) {\n      getClassesRule().then(datas => {\n        this.tableData = datas.data;\n        let json = JSON.parse(this.tableData[0].ruleValue);\n        this.tableData[0].ruleValue = json.position;\n        this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n        const rules = {\n          ruleTitle: \"班次时间段\",\n          ruleValue: json.period\n        };\n        this.tableData.unshift(rules);\n        console.log(datas.data);\n      });\n    }\n  },\n  methods: {\n    handleEdit(index, row) {\n      getAllRule().then(datas => {\n        // console.log(datas.data.length);\n        console.log(\"label000:\" + this.label000);\n        console.log(\"label111:\" + this.label111);\n      });\n      // console.log(this.tableData[0].ruleValue);\n      this.addDialogVisible = true;\n      this.rulenamee = this.tableData[index].ruleTitle;\n      this.rulevaluee = this.tableData[index].ruleValue;\n    },\n    //删除规则\n    async handleDelete(index, row) {\n      this.rulenamee = this.tableData[index].ruleTitle;\n      if (this.label111 != -1 && this.label000 == 0) {\n        if (this.rulenamee == \"班次时间段\") {\n          this.sstr = '{\"period\": \"\", \"position\": \"' + this.tableData[1].ruleValue + '\"}';\n          console.log(this.sstr);\n        } else {\n          this.sstr = '{\"period\": \"' + this.tableData[0].ruleValue + '\", \"position\": \"\"}';\n          console.log(this.sstr);\n        }\n        await updateClassesByStoreId(this.label111, this.sstr);\n        this.addDialogVisible = false;\n        await getClassesByStoreId(this.label111).then(datass => {\n          this.tableData = datass.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.position;\n          this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n          const rules = {\n            ruleTitle: \"班次时间段\",\n            ruleValue: json.period\n          };\n          this.tableData.unshift(rules);\n          console.log(datass.data);\n        });\n      } else if (this.label111 == -1) {\n        this.NoDelete = true;\n      } else {\n        this.NoDelete1 = true;\n      }\n    },\n    //点击确认编辑button确认编辑规则\n    async handelUpdate() {\n      if (this.rulevaluee == \"\") {\n        this.Noemptyy = true;\n      } else {\n        //是分店\n        if (this.label111 != -1) {\n          //分店无独立规则则插入一条新规则\n          if (this.label000 == 1) {\n            if (this.rulenamee == \"班次时间段\") {\n              this.sstr = '{\"period\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[1].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"period\": \"' + this.tableData[0].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            getAllRule().then(async datas => {\n              this.lengthh = datas.data.length + 1;\n              this.lengthh = this.lengthh.toString();\n              console.log(this.lengthh);\n              console.log(this.label111);\n              await insertClasses(this.lengthh, this.label111, this.sstr);\n              this.addDialogVisible = false;\n              await getClassesByStoreId(this.label111).then(datass => {\n                this.tableData = datass.data;\n                let json = JSON.parse(this.tableData[0].ruleValue);\n                this.tableData[0].ruleValue = json.position;\n                this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n                const rules = {\n                  ruleTitle: \"班次时间段\",\n                  ruleValue: json.period\n                };\n                this.tableData.unshift(rules);\n                console.log(datass.data);\n              });\n              // this.reload();\n            });\n          }\n          //分店有独立规则则进行编辑（update\n          else {\n            if (this.rulenamee == \"班次时间段\") {\n              this.sstr = '{\"period\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[1].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"period\": \"' + this.tableData[0].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            await updateClassesByStoreId(this.label111, this.sstr);\n            this.addDialogVisible = false;\n            await getClassesByStoreId(this.label111).then(datass => {\n              this.tableData = datass.data;\n              let json = JSON.parse(this.tableData[0].ruleValue);\n              this.tableData[0].ruleValue = json.position;\n              this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n              const rules = {\n                ruleTitle: \"班次时间段\",\n                ruleValue: json.period\n              };\n              this.tableData.unshift(rules);\n              console.log(datass.data);\n            });\n            // this.reload();\n          }\n        }\n        //不是分店\n        else {\n          console.log(\"0:\" + this.tableData[0].ruleValue);\n          console.log(\"1:\" + this.tableData[1].ruleValue);\n          if (this.rulenamee == \"班次时间段\") {\n            this.sstr = '{\"period\": \"' + this.rulevaluee + '\", \"position\": \"' + this.tableData[1].ruleValue + '\"}';\n            console.log(this.sstr);\n          } else {\n            this.sstr = '{\"period\": \"' + this.tableData[0].ruleValue + '\", \"position\": \"' + this.rulevaluee + '\"}';\n            console.log(this.sstr);\n          }\n          console.log(this.rulevaluee);\n          await updateClasses(this.sstr);\n          this.addDialogVisible = false;\n          await getClassesRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.position;\n            this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\n            const rules = {\n              ruleTitle: \"班次时间段\",\n              ruleValue: json.period\n            };\n            this.tableData.unshift(rules);\n            console.log(datas.data);\n          });\n          // this.reload();\n        }\n      }\n    },\n\n    getClassesRules() {\n      getClassesRule().then(datas => {\n        this.tableData.ruleTitle = datas.data[0].ruleTitle;\n        this.tableData.rulevaluee = datas.data[0].ruleValue;\n        console.log(datas.data);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","ElMessageBox","rowProps","getClassesRule","updateClasses","getClassesByStoreId","insertClasses","getAllRule","updateClassesByStoreId","inject","name","data","rulenamee","rulevaluee","label111","label000","lengthh","tableData","tableDatas","ruleTitle","ruleValue","addDialogVisible","NoDelete","NoDelete1","Noemptyy","addForm","ruleName","ruleContent","mounted","sessionStorage","getItem","console","log","then","datas","length","json","JSON","parse","position","rules","period","unshift","methods","handleEdit","index","row","handleDelete","sstr","datass","handelUpdate","toString","getClassesRules"],"sourceRoot":"","sources":["E:\\work\\vue\\schedule\\intelligent-schedule\\src\\views\\ShiftSchedule\\components\\ClassesRules.vue"],"sourcesContent":["<template>\r\n  <div class=\"rules\">\r\n    <div class=\"title\">\r\n      <h2>班次规则</h2>\r\n    </div>\r\n    <div class=\"rulesList\">\r\n      <el-table :data=\"tableData\" style=\"width: 100%\" stripe>\r\n        <el-table-column label=\"\" prop=\"ruleTitle\"> </el-table-column>\r\n        <el-table-column label=\"\" prop=\"ruleValue\"> </el-table-column>\r\n        <el-table-column label=\"\">\r\n          <template v-slot=\"scope\">\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"primary\"\r\n              @click=\"handleEdit(scope.$index, scope.row)\"\r\n            >\r\n              编辑\r\n            </el-link>\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"danger\"\r\n              @click=\"handleDelete(scope.$index, scope.row)\"\r\n              >删除</el-link\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <!-- 编辑规则对话框 -->\r\n    <el-dialog v-model=\"addDialogVisible\" title=\"编辑规则\" width=\"30%\">\r\n      <el-form :model=\"addForm\">\r\n        <el-form-item :label=\"this.rulenamee\" label-width=\"66%\"> </el-form-item>\r\n        <el-form-item label=\"规则内容：\" prop=\"rulevaluee\">\r\n          <el-input\r\n            v-model=\"this.rulevaluee\"\r\n            placeholder=\"请输入规则内容\"\r\n            clearable\r\n            :style=\"{ width: '100%' }\"\r\n          >\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handelUpdate\"> 确定 </el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm\">\r\n        <el-form-item label=\"无法删除通用规则\" label-width=\"66%\" prop=\"nono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete1\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm1\">\r\n        <el-form-item\r\n          label=\"该分店无独立规则，无法进行删除操作\"\r\n          label-width=\"90%\"\r\n          prop=\"nono\"\r\n        >\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete1 = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"Noemptyy\" title=\"不能为空\" width=\"30%\">\r\n      <el-form :model=\"Noempty\">\r\n        <el-form-item label=\"输入值不能为空\" label-width=\"66%\" prop=\"nonono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"Noemptyy = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from \"vue\";\r\nimport { ElMessageBox, rowProps } from \"element-plus\";\r\nimport {\r\n  getClassesRule,\r\n  updateClasses,\r\n  getClassesByStoreId,\r\n  insertClasses,\r\n  getAllRule,\r\n  updateClassesByStoreId,\r\n} from \"@/api\";\r\n\r\nexport default {\r\n  inject: [\"reload\"],\r\n  name: \"Classes\",\r\n  data() {\r\n    return {\r\n      rulenamee: \"\",\r\n      rulevaluee: \"\",\r\n      label111: -1,\r\n      //修改通用规则则为0，用通用规则但是分店则为1\r\n      label000: 0,\r\n      lengthh: 0,\r\n\r\n      tableData: [],\r\n\r\n      tableDatas: {\r\n        ruleTitle: \"\",\r\n        ruleValue: \"\",\r\n      },\r\n\r\n      addDialogVisible: false,\r\n      NoDelete: false,\r\n      NoDelete1: false,\r\n      Noemptyy: false,\r\n      addForm: {\r\n        ruleName: \"\",\r\n        ruleContent: \"\",\r\n      },\r\n    };\r\n  },\r\n\r\n  mounted() {\r\n    //获取通用规则\r\n    this.label111 = sessionStorage.getItem(\"label111\");\r\n    console.log(this.label111);\r\n    //不是总门店\r\n    if (this.label111 != -1) {\r\n      getClassesByStoreId(this.label111).then(async (datas) => {\r\n        //没有自己的规则就用通用规则\r\n        if (datas.data.length == 0) {\r\n          getClassesRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"班次时间段\",\r\n              ruleValue: json.period,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            console.log(datas.data);\r\n            this.label000 = 1;\r\n          });\r\n        } else if (\r\n          datas.data[0].ruleValue == '{\"period\": \"\", \"position\": \"\"}'\r\n        ) {\r\n          getClassesRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"班次时间段\",\r\n              ruleValue: json.period,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            console.log(datas.data);\r\n          });\r\n        } else {\r\n          this.tableData = datas.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.position;\r\n          this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n          const rules = {\r\n            ruleTitle: \"班次时间段\",\r\n            ruleValue: json.period,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          console.log(datas.data);\r\n        }\r\n      });\r\n    } else if (this.label111 == -1) {\r\n      getClassesRule().then((datas) => {\r\n        this.tableData = datas.data;\r\n        let json = JSON.parse(this.tableData[0].ruleValue);\r\n        this.tableData[0].ruleValue = json.position;\r\n        this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n        const rules = {\r\n          ruleTitle: \"班次时间段\",\r\n          ruleValue: json.period,\r\n        };\r\n        this.tableData.unshift(rules);\r\n        console.log(datas.data);\r\n      });\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    handleEdit(index, row) {\r\n      getAllRule().then((datas) => {\r\n        // console.log(datas.data.length);\r\n        console.log(\"label000:\" + this.label000);\r\n        console.log(\"label111:\" + this.label111);\r\n      });\r\n      // console.log(this.tableData[0].ruleValue);\r\n      this.addDialogVisible = true;\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      this.rulevaluee = this.tableData[index].ruleValue;\r\n    },\r\n\r\n    //删除规则\r\n    async handleDelete(index, row) {\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      if (this.label111 != -1 && this.label000 == 0) {\r\n        if (this.rulenamee == \"班次时间段\") {\r\n          this.sstr =\r\n            '{\"period\": \"\", \"position\": \"' + this.tableData[1].ruleValue + '\"}';\r\n          console.log(this.sstr);\r\n        } else {\r\n          this.sstr =\r\n            '{\"period\": \"' + this.tableData[0].ruleValue + '\", \"position\": \"\"}';\r\n          console.log(this.sstr);\r\n        }\r\n        await updateClassesByStoreId(this.label111, this.sstr);\r\n        this.addDialogVisible = false;\r\n\r\n        await getClassesByStoreId(this.label111).then((datass) => {\r\n          this.tableData = datass.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.position;\r\n          this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n          const rules = {\r\n            ruleTitle: \"班次时间段\",\r\n            ruleValue: json.period,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          console.log(datass.data);\r\n        });\r\n      } else if (this.label111 == -1) {\r\n        this.NoDelete = true;\r\n      } else {\r\n        this.NoDelete1 = true;\r\n      }\r\n    },\r\n\r\n    //点击确认编辑button确认编辑规则\r\n    async handelUpdate() {\r\n      if (this.rulevaluee == \"\") {\r\n        this.Noemptyy = true;\r\n      } else {\r\n        //是分店\r\n        if (this.label111 != -1) {\r\n          //分店无独立规则则插入一条新规则\r\n          if (this.label000 == 1) {\r\n            if (this.rulenamee == \"班次时间段\") {\r\n              this.sstr =\r\n                '{\"period\": \"' +\r\n                this.rulevaluee +\r\n                '\", \"position\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else {\r\n              this.sstr =\r\n                '{\"period\": \"' +\r\n                this.tableData[0].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.rulevaluee +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            }\r\n            getAllRule().then(async (datas) => {\r\n              this.lengthh = datas.data.length + 1;\r\n              this.lengthh = this.lengthh.toString();\r\n              console.log(this.lengthh);\r\n              console.log(this.label111);\r\n              await insertClasses(this.lengthh, this.label111, this.sstr);\r\n              this.addDialogVisible = false;\r\n\r\n              await getClassesByStoreId(this.label111).then((datass) => {\r\n                this.tableData = datass.data;\r\n                let json = JSON.parse(this.tableData[0].ruleValue);\r\n                this.tableData[0].ruleValue = json.position;\r\n                this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n                const rules = {\r\n                  ruleTitle: \"班次时间段\",\r\n                  ruleValue: json.period,\r\n                };\r\n                this.tableData.unshift(rules);\r\n                console.log(datass.data);\r\n              });\r\n              // this.reload();\r\n            });\r\n          }\r\n          //分店有独立规则则进行编辑（update\r\n          else {\r\n            if (this.rulenamee == \"班次时间段\") {\r\n              this.sstr =\r\n                '{\"period\": \"' +\r\n                this.rulevaluee +\r\n                '\", \"position\": \"' +\r\n                this.tableData[1].ruleValue +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            } else {\r\n              this.sstr =\r\n                '{\"period\": \"' +\r\n                this.tableData[0].ruleValue +\r\n                '\", \"position\": \"' +\r\n                this.rulevaluee +\r\n                '\"}';\r\n              console.log(this.sstr);\r\n            }\r\n            await updateClassesByStoreId(this.label111, this.sstr);\r\n            this.addDialogVisible = false;\r\n\r\n            await getClassesByStoreId(this.label111).then((datass) => {\r\n              this.tableData = datass.data;\r\n              let json = JSON.parse(this.tableData[0].ruleValue);\r\n              this.tableData[0].ruleValue = json.position;\r\n              this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n              const rules = {\r\n                ruleTitle: \"班次时间段\",\r\n                ruleValue: json.period,\r\n              };\r\n              this.tableData.unshift(rules);\r\n              console.log(datass.data);\r\n            });\r\n            // this.reload();\r\n          }\r\n        }\r\n        //不是分店\r\n        else {\r\n          console.log(\"0:\" + this.tableData[0].ruleValue);\r\n          console.log(\"1:\" + this.tableData[1].ruleValue);\r\n          if (this.rulenamee == \"班次时间段\") {\r\n            this.sstr =\r\n              '{\"period\": \"' +\r\n              this.rulevaluee +\r\n              '\", \"position\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else {\r\n            this.sstr =\r\n              '{\"period\": \"' +\r\n              this.tableData[0].ruleValue +\r\n              '\", \"position\": \"' +\r\n              this.rulevaluee +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          }\r\n          console.log(this.rulevaluee);\r\n          await updateClasses(this.sstr);\r\n          this.addDialogVisible = false;\r\n\r\n          await getClassesRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.position;\r\n            this.tableData[0].ruleTitle = \"该班次时间段限定职位（数组）\";\r\n            const rules = {\r\n              ruleTitle: \"班次时间段\",\r\n              ruleValue: json.period,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            console.log(datas.data);\r\n          });\r\n          // this.reload();\r\n        }\r\n      }\r\n    },\r\n\r\n    getClassesRules() {\r\n      getClassesRule().then((datas) => {\r\n        this.tableData.ruleTitle = datas.data[0].ruleTitle;\r\n        this.tableData.rulevaluee = datas.data[0].ruleValue;\r\n        console.log(datas.data);\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.el-link {\r\n  margin-left: 17px;\r\n}\r\n.rules {\r\n  .title {\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n  .rulesList {\r\n    margin-top: 20px;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}