{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport moment from \"moment\";\nimport { Delete, Edit, Postcard, Finished } from '@element-plus/icons-vue';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport SlideSelection from '../components/SlideSelection.vue';\nimport weekDrag from '../components/WeekDrag.vue';\nimport dayDrag from '../components/DayDrag.vue';\nimport { getAllStore, getAllEmployee, getAWeekwork, getADaywork, deleteScheduling, updateWeekData, deleteDaySchedule, replaceDaySchedule, getPeriodAll, getPeriodDay, getSize, autoSchedul, getStorePersons } from '@/api';\nimport { events as ctx } from \"vuedraggable/src/core/sortableEvents\";\n\n/**\r\n * 初始化获取数据库数据：stores、data、employees\r\n */\n// 门店切换\n\nexport default {\n  __name: 'ShiftSchedule',\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const stores = ref([]);\n    const storeValue = ref();\n\n    //所有员工数据\n    const employees = ref([]);\n    const employeesAvail = ref([]);\n\n    //表格单元格数据\n    var data = [];\n    const tableData = ref([]);\n    const dayData = ref([]);\n    const weekIndex = [0, 1, 1, 1, 1, 1, 0];\n\n    //表格左侧时间段\n    const timesWeek = ref([]);\n    const timesDay = ref([]);\n    const size = ref([]);\n    let persons = ref();\n    const needpersons = ref(18);\n    let dialogVisible = ref(false);\n    const submitForm = needperson => {\n      // console.log(\"第一天\"+current.value.startOf('isoWeek').format('YYYY-MM-DD'))\n      let monday = current.value.startOf('isoWeek').format('YYYY-MM-DD');\n      console.log(storeValue.value + \"   \" + needperson + \"   \" + monday);\n      autoSchedul(storeValue.value, needperson, monday).then(datas => {\n        console.log(datas.data);\n      });\n      dialogVisible.value = false;\n    };\n    //初始化获取数据库\n    getAllStore().then(datas => {\n      stores.value = datas.data;\n      storeValue.value = stores.value[0].storeId;\n      getPeriodAll(storeValue.value).then(datas => {\n        timesWeek.value = datas.data;\n      });\n      getPeriodDay(storeValue.value, 1).then(datas => {\n        timesDay.value.push(datas.data);\n      });\n      getPeriodDay(storeValue.value, 0).then(datas => {\n        timesDay.value.push(datas.data);\n      });\n      getSize(storeValue.value).then(datas => {\n        size.value = datas.data;\n      });\n      getAllEmployee(stores.value[0].storeId).then(datas => {\n        employees.value = datas.data;\n        employeesAvail.value = [...employees.value];\n      });\n      loading.value = true;\n      getAWeekwork(moment().startOf('isoWeek').format('YYYY-MM-DD'), moment().endOf('isoWeek').format('YYYY-MM-DD'), storeValue.value).then(datas => {\n        data = datas.data;\n        tableData.value = data[0].map(function (col, i) {\n          return data.map(function (row) {\n            return row[i];\n          });\n        });\n        console.log(tableData.value);\n        loading.value = false;\n      });\n      loading.value = true;\n      getADaywork(moment().format('YYYY-MM-DD'), weekIndex[moment().day()], storeValue.value).then(datas => {\n        dayData.value = datas.data;\n        loading.value = false;\n      });\n    });\n\n    /**\r\n     * 初始化本地变量\r\n     */\n    /* 固定变量 */\n    //全部查看|按岗位分组|按员工分组\n    const viewMethods = [{\n      label: 1,\n      value: '全部查看'\n    }, {\n      label: 2,\n      value: '按岗位分组'\n    }, {\n      label: 3,\n      value: '按员工分组'\n    }];\n    const slideRef = ref();\n    const weekDragRef = ref();\n    const dayDragRef = ref();\n\n    /* 需修改变量 */\n    //按周查看|按日查看 的切换\n    const week_day = ref('week');\n\n    //全部查看|按岗位分组|按员工分组 的切换\n    const viewValue = ref(viewMethods[0].value);\n    const current = ref(moment());\n    const labels = ref(['周一 ' + current.value.startOf('isoWeek').format('M月D日'), '周二 ' + current.value.startOf('isoWeek').add(1, 'days').format('M月D日'), '周三 ' + current.value.startOf('isoWeek').add(2, 'days').format('M月D日'), '周四 ' + current.value.startOf('isoWeek').add(3, 'days').format('M月D日'), '周五 ' + current.value.startOf('isoWeek').add(4, 'days').format('M月D日'), '周六 ' + current.value.startOf('isoWeek').add(5, 'days').format('M月D日'), '周日 ' + current.value.startOf('isoWeek').add(6, 'days').format('M月D日')]);\n\n    //被点击单元格的坐标s\n    var arrTd = [];\n\n    //编辑button的文本切换\n    const edit = ref('编辑');\n\n    //表格标签\n    const table = ref({\n      time: '时间',\n      week1: labels.value[0],\n      week2: labels.value[1],\n      week3: labels.value[2],\n      week4: labels.value[3],\n      week5: labels.value[4],\n      week6: labels.value[5],\n      week7: labels.value[6]\n    });\n\n    //加载数据\n    const loading = ref(true);\n\n    //是否可拖拽drag，拖拽起点dragging，拖拽终点ending\n    const drag = ref(false);\n    const ending = ref(null);\n    const dragging = ref(null);\n\n    //是否显示添加员工对话框\n    const showDialog = ref(false);\n    //对话框里的员工下拉框\n    const employeeValue = ref('请选择要添加的员工');\n    //已处于选中单元格中的员工s\n    var addIndex = null;\n\n    /**\r\n     * 函数\r\n     */\n    //修改门店\n    const changeStore = () => {\n      getStoreData();\n\n      //周切换\n      slideRef.value.initWeeks();\n\n      //日切换\n      slideRef.value.initDays();\n      initVariable();\n    };\n\n    //修改按周查看|按日查看\n    const chooseWorD = button => {\n      //获取数据库data、dayData\n      if (button === 'week' && week_day.value === 'day') {\n        week_day.value = 'week';\n\n        //周切换\n        slideRef.value.initWeeks();\n      } else if (button === 'day' && week_day.value === 'week') {\n        week_day.value = 'day';\n\n        //日切换\n        slideRef.value.initDays();\n      }\n      initVariable();\n    };\n\n    //点击多选单元格\n    const handleClickTd = (row, col) => {\n      var flag = 0;\n      var td = document.getElementById('td' + week_day.value + row + '-' + col);\n      arrTd.map((value, index) => {\n        if (value.toString() === [row, col].toString()) {\n          arrTd.splice(index, 1);\n          td.style.backgroundColor = '';\n          flag = 1;\n          return;\n        }\n      });\n      if (flag === 0) {\n        arrTd.push([row, col]);\n        td.style.backgroundColor = '#ffe0e0';\n      }\n      console.log(arrTd);\n    };\n    //点击删除button删除单元格内容\n    const handleDelete = () => {\n      if (edit.value === '完成') {\n        message('正处于编辑状态，不可删除');\n      } else if (arrTd.length === 0) {\n        message('请选择要删除内容的单元格');\n      } else {\n        ElMessageBox.confirm('单元格内容将永久被删除，确定吗?', 'Warning', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          if (week_day.value === 'week') {\n            var newData = [...tableData.value];\n            var deleteIds = [];\n            arrTd.map(value => {\n              if (value[1] < 5) {\n                if (tableData.value[value[0]][value[1]][1] !== null) deleteIds.push(tableData.value[value[0]][value[1]][1]);\n                newData[value[0]][value[1]] = [];\n              } else {\n                if (tableData.value[value[0] - (size.value[0] - size.value[1])][value[1]][1] !== null) deleteIds.push(tableData.value[value[0] - (size.value[0] - size.value[1])][value[1]][1]);\n                newData[value[0] - (size.value[0] - size.value[1])][value[1]] = [];\n              }\n              let td = document.getElementById('td' + week_day.value + value[0] + '-' + value[1]);\n              // console.log(td)\n              td.style.backgroundColor = '';\n            });\n            tableData.value = [...newData];\n            deleteScheduling(deleteIds);\n          } else {\n            var newDayData = [...dayData.value];\n            var updateIndexs = [];\n            var updateEmployeeIds = \"\";\n            arrTd.map((value, index) => {\n              if (JSON.stringify(newDayData[value[0]][value[1]]) !== '{}' && newDayData[value[0]][value[1]].employeeId !== null) updateIndexs.push(value[0]);\n              newDayData[value[0]][value[1]] = {};\n              let td = document.getElementById('td' + week_day.value + value[0] + '-' + value[1]);\n              td.style.backgroundColor = '';\n            });\n            dayData.value = [...newDayData];\n            updateIndexs = [...new Set(updateIndexs)];\n            updateIndexs.map((value, index) => {\n              let employeeIds = \"\";\n              newDayData[value].map(v => {\n                if (v.employeeId !== null && JSON.stringify(v) !== '{}' && employeeIds === \"\") employeeIds += v.employeeId;else if (v.employeeId !== null && JSON.stringify(v) !== '{}') employeeIds += \",\" + v.employeeId;\n              });\n              if (index === 0) updateEmployeeIds += employeeIds;else updateEmployeeIds += \"=\" + employeeIds;\n            });\n            console.log(updateEmployeeIds);\n            console.log(current.value.format('YYYY-MM-DD'));\n            console.log(weekIndex[current.value.day()]);\n            console.log(updateIndexs.join(','));\n            console.log(storeValue.value);\n            deleteDaySchedule(updateEmployeeIds, current.value.format('YYYY-MM-DD'), weekIndex[current.value.day()], updateIndexs.join(','), storeValue.value);\n          }\n          arrTd.splice(0, arrTd.length);\n          ElMessage({\n            type: 'success',\n            message: '删除成功'\n          });\n        }).catch(() => {\n          ElMessage({\n            type: 'info',\n            message: '取消删除'\n          });\n        });\n      }\n    };\n    //点击编辑|完成\n    const handleEdit = () => {\n      if (edit.value === '编辑') {\n        var tds = document.querySelectorAll('td');\n        for (var i = 1; i < tds.length; i++) {\n          if (tds[i].id !== 'td-time') tds[i].style.backgroundColor = '';\n        }\n      } else {\n        if (week_day.value === 'week') {\n          updateSchedule();\n        } else {\n          var updateEmployeeIds = \"\";\n          dayData.value.map((value, index) => {\n            var employeeIds = \"\";\n            var flag = 0;\n            value.map((v, i) => {\n              if (JSON.stringify(v) !== '{}' && v.employeeId !== null && flag === 0) {\n                employeeIds += v.employeeId;\n                flag = 1;\n              } else if (JSON.stringify(v) !== '{}' && v.employeeId !== null) employeeIds += \",\" + v.employeeId;\n            });\n            if (index === 0) updateEmployeeIds += employeeIds;else updateEmployeeIds += \"=\" + employeeIds;\n          });\n          replaceDaySchedule(updateEmployeeIds, storeValue.value, current.value.format('YYYY-MM-DD'), current.value.day());\n        }\n      }\n      if (week_day.value === 'week') weekDragRef.value.weekEdit();else dayDragRef.value.dayEdit();\n      edit.value = edit.value === '编辑' ? '完成' : '编辑';\n    };\n\n    //更新数据库排班数据\n    const updateSchedule = () => {\n      var tb = tableData.value.map(row => {\n        row = row.map(item => {\n          item = item.map((two, index) => {\n            if (index === 0) {\n              var tb1 = [];\n              two.map(em => {\n                tb1.push(JSON.stringify(em));\n              });\n              return tb1.join('>');\n            } else return two;\n          });\n          return item.join('+');\n        });\n        return row.join('-');\n      });\n      var week = current.value.startOf('W').format(\"YYYY-MM-DD\");\n      for (var i = 1; i < 7; i++) week += \",\" + current.value.startOf('W').add(i, 'days').format(\"YYYY-MM-DD\");\n      updateWeekData(tb.join('<'), week, storeValue.value);\n    };\n    const dragInit = () => {\n      if (week_day.value === 'week') weekDragRef.value.initDrag();else dayDragRef.value.initDrag();\n    };\n\n    //显示添加员工对话框、添加员工\n    const showAddView = (added, index1, index2) => {\n      console.log(added, index1, index2);\n      employeeValue.value = '请选择要添加的员工';\n      addIndex = [index1, index2];\n      var newEAvil = [...employees.value];\n      if (week_day.value === 'week') {\n        newEAvil = newEAvil.filter(item => {\n          var isInclude = false;\n          added.map(value => {\n            if (value.employeeId === item.employeeId) {\n              isInclude = true;\n              return;\n            }\n          });\n          // console.log(isInclude);\n          return !isInclude;\n        });\n      } else {\n        newEAvil = newEAvil.filter(item => {\n          var isInclude = false;\n          console.log(dayData.value[index1]);\n          dayData.value[index1].map(value => {\n            console.log(value);\n            if (JSON.stringify(value) !== '{}' && value.employeeId !== null) {\n              if (value.employeeId === item.employeeId) {\n                isInclude = true;\n                return;\n              }\n            }\n          });\n          // console.log(isInclude);\n          return !isInclude;\n        });\n      }\n      employeesAvail.value = [...newEAvil];\n      console.log(employeesAvail);\n      showDialog.value = true;\n    };\n    const addEmplyee = () => {\n      if (employeeValue.value === '请选择要添加的员工') {\n        message(\"请选择要添加的员工\");\n      } else {\n        if (week_day.value === 'week') {\n          let newData = [...tableData.value];\n          newData[addIndex[0]][addIndex[1]][0].push(employeeValue.value);\n          console.log(newData);\n          tableData.value = [...newData];\n        } else {\n          let newData = [...dayData.value];\n          newData[addIndex[0]][addIndex[1]] = employeeValue.value;\n          dayData.value = [...newData];\n        }\n      }\n      showDialog.value = false;\n    };\n\n    //工具类\n    const message = str => {\n      return ElMessage({\n        showClose: true,\n        message: str,\n        type: 'warning',\n        grouping: true\n      });\n    };\n    const initVariable = () => {\n      //全部查看|按岗位分组|按员工分组 的切换\n      viewValue.value = viewMethods[0].value;\n\n      //被点击单元格的坐标s\n      arrTd = [];\n\n      //编辑button的文本切换\n      edit.value = '编辑';\n\n      //是否可拖拽drag，拖拽起点dragging，拖拽终点ending\n      drag.value = false;\n      ending.value = null;\n      dragging.value = null;\n\n      //是否显示添加员工对话框\n      showDialog.value = false;\n      //对话框里的员工下拉框\n      employeeValue.value = '请选择要添加的员工';\n      //已处于选中单元格中的员工s\n      addIndex = null;\n      var tds = document.querySelectorAll('td');\n      for (var i = 1; i < tds.length; i++) {\n        if (tds[i].id !== 'td-time') tds[i].style.backgroundColor = '';\n      }\n    };\n    const updateTableData = () => {\n      console.log(storeValue.value);\n      console.log(current.value);\n      loading.value = true;\n      getAWeekwork(current.value.startOf('isoWeek').format('YYYY-MM-DD'), current.value.endOf('isoWeek').format('YYYY-MM-DD'), storeValue.value).then(datas => {\n        console.log(datas.data);\n        let data = datas.data;\n        tableData.value = data[0].map(function (col, i) {\n          return data.map(function (row) {\n            return row[i];\n          });\n        });\n        console.log(tableData.value);\n        loading.value = false;\n      });\n      console.log(tableData.value);\n    };\n    const updateDayDate = () => {\n      loading.value = true;\n      getADaywork(current.value.format('YYYY-MM-DD'), weekIndex[current.value.day()], storeValue.value).then(datas => {\n        dayData.value = datas.data;\n        loading.value = false;\n      });\n    };\n    const getStoreData = () => {\n      console.log(storeValue.value);\n      getPeriodAll(storeValue.value).then(datas => {\n        timesWeek.value = datas.data;\n      });\n      getPeriodDay(storeValue.value, 1).then(datas => {\n        timesDay.value.push(datas.data);\n      });\n      getPeriodDay(storeValue.value, 0).then(datas => {\n        timesDay.value.push(datas.data);\n      });\n      getSize(storeValue.value).then(datas => {\n        size.value = datas.data;\n      });\n      getAllEmployee(stores.value[0].storeId).then(datas => {\n        employees.value = datas.data;\n        employeesAvail.value = [...employees.value];\n      });\n    };\n    const __returned__ = {\n      stores,\n      storeValue,\n      employees,\n      employeesAvail,\n      get data() {\n        return data;\n      },\n      set data(v) {\n        data = v;\n      },\n      tableData,\n      dayData,\n      weekIndex,\n      timesWeek,\n      timesDay,\n      size,\n      get persons() {\n        return persons;\n      },\n      set persons(v) {\n        persons = v;\n      },\n      needpersons,\n      get dialogVisible() {\n        return dialogVisible;\n      },\n      set dialogVisible(v) {\n        dialogVisible = v;\n      },\n      submitForm,\n      viewMethods,\n      slideRef,\n      weekDragRef,\n      dayDragRef,\n      week_day,\n      viewValue,\n      current,\n      labels,\n      get arrTd() {\n        return arrTd;\n      },\n      set arrTd(v) {\n        arrTd = v;\n      },\n      edit,\n      table,\n      loading,\n      drag,\n      ending,\n      dragging,\n      showDialog,\n      employeeValue,\n      get addIndex() {\n        return addIndex;\n      },\n      set addIndex(v) {\n        addIndex = v;\n      },\n      changeStore,\n      chooseWorD,\n      handleClickTd,\n      handleDelete,\n      handleEdit,\n      updateSchedule,\n      dragInit,\n      showAddView,\n      addEmplyee,\n      message,\n      initVariable,\n      updateTableData,\n      updateDayDate,\n      getStoreData,\n      ref,\n      get moment() {\n        return moment;\n      },\n      get Delete() {\n        return Delete;\n      },\n      get Edit() {\n        return Edit;\n      },\n      get Postcard() {\n        return Postcard;\n      },\n      get Finished() {\n        return Finished;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      SlideSelection,\n      weekDrag,\n      dayDrag,\n      get getAllStore() {\n        return getAllStore;\n      },\n      get getAllEmployee() {\n        return getAllEmployee;\n      },\n      get getAWeekwork() {\n        return getAWeekwork;\n      },\n      get getADaywork() {\n        return getADaywork;\n      },\n      get deleteScheduling() {\n        return deleteScheduling;\n      },\n      get updateWeekData() {\n        return updateWeekData;\n      },\n      get deleteDaySchedule() {\n        return deleteDaySchedule;\n      },\n      get replaceDaySchedule() {\n        return replaceDaySchedule;\n      },\n      get getPeriodAll() {\n        return getPeriodAll;\n      },\n      get getPeriodDay() {\n        return getPeriodDay;\n      },\n      get getSize() {\n        return getSize;\n      },\n      get autoSchedul() {\n        return autoSchedul;\n      },\n      get getStorePersons() {\n        return getStorePersons;\n      },\n      get ctx() {\n        return ctx;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","moment","Delete","Edit","Postcard","Finished","ElMessage","ElMessageBox","SlideSelection","weekDrag","dayDrag","getAllStore","getAllEmployee","getAWeekwork","getADaywork","deleteScheduling","updateWeekData","deleteDaySchedule","replaceDaySchedule","getPeriodAll","getPeriodDay","getSize","autoSchedul","getStorePersons","events","ctx","stores","storeValue","employees","employeesAvail","data","tableData","dayData","weekIndex","timesWeek","timesDay","size","persons","needpersons","dialogVisible","submitForm","needperson","monday","current","value","startOf","format","console","log","then","datas","storeId","push","loading","endOf","map","col","i","row","day","viewMethods","label","slideRef","weekDragRef","dayDragRef","week_day","viewValue","labels","add","arrTd","edit","table","time","week1","week2","week3","week4","week5","week6","week7","drag","ending","dragging","showDialog","employeeValue","addIndex","changeStore","getStoreData","initWeeks","initDays","initVariable","chooseWorD","button","handleClickTd","flag","td","document","getElementById","index","toString","splice","style","backgroundColor","handleDelete","message","length","confirm","confirmButtonText","cancelButtonText","type","newData","deleteIds","newDayData","updateIndexs","updateEmployeeIds","JSON","stringify","employeeId","Set","employeeIds","v","join","catch","handleEdit","tds","querySelectorAll","id","updateSchedule","weekEdit","dayEdit","tb","item","two","tb1","em","week","dragInit","initDrag","showAddView","added","index1","index2","newEAvil","filter","isInclude","addEmplyee","str","showClose","grouping","updateTableData","updateDayDate"],"sources":["E:/work/vue/schedule/intelligent-schedule/src/views/ShiftSchedule.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <el-select v-model=\"storeValue\" filterable class=\"store\" size=\"large\" @change=\"changeStore\">\r\n      <el-option v-for=\"store in stores\" :key=\"store.storeId\" :label=\"store.storeName\" :value=\"store.storeId\" />\r\n    </el-select>\r\n\r\n    <div class=\"time\">\r\n      <span>{{ current.format('YYYY年M月') }}</span>\r\n    </div>\r\n\r\n    <div class=\"view-options\">\r\n      <div class=\"view\">\r\n        <el-button type=\"primary\" :class=\"week_day === 'week' ? 'view-choose' : 'view-notchoose'\"\r\n                   @click=\"chooseWorD('week')\">按周查看</el-button>\r\n        <el-button type=\"primary\" :class=\"week_day === 'day' ? 'view-choose' : 'view-notchoose'\"\r\n                   @click=\"chooseWorD('day')\">按日查看</el-button>\r\n      </div>\r\n\r\n      <SlideSelection ref=\"slideRef\" :week_day=\"week_day\" @emitCurrent=\"(current1) => current = current1\"\r\n                      @emitTable=\"(table1) => table = table1\" @updateTableData=\"updateTableData\" @updateDayDate=\"updateDayDate\"\r\n                      @initVariable=\"initVariable\" @dragInit=\"dragInit\" />\r\n    </div>\r\n\r\n    <div class=\"view-button\">\r\n      <el-select v-model=\"viewValue\" filterable class=\"store\" size=\"large\">\r\n        <el-option v-for=\"viewMethod in viewMethods\" :key=\"viewMethod.label\" :label=\"viewMethod.value\"\r\n                   :value=\"viewMethod.value\" />\r\n      </el-select>\r\n\r\n      <div class=\"buttonView\">\r\n        <el-button type=\"danger\" :icon=\"Delete\" @click=\"handleDelete\" title=\"删除单元格内容\">删除</el-button>\r\n        <el-button :class=\"edit === '完成' ? 'button-choose' : null\" type=\"primary\" :icon=\"Edit\"\r\n                   @click=\"handleEdit\">{{ edit }}</el-button>\r\n        <el-button  @click=\"dialogVisible = true\" v-if=\"week_day === 'week'\" type=\"success\" :icon=\"Postcard\">一键生成排班</el-button>\r\n\r\n        <!--        @click=\"confermessage\"-->\r\n\r\n        <el-button v-if=\"week_day === 'week'\" type=\"success\" :icon=\"Finished\"\r\n                   @click=\"updateSchedule\">保存排班</el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <el-dialog v-model=\"dialogVisible\">\r\n      <el-form ref=\"returnForm\" label-width=\"100px\" class=\"demo-ruleForm\">\r\n        <el-form-item style=\"float:right\">\r\n          <p><label>可排班人数：</label>\r\n            <span v-text=\"persons\" style=\"margin-right: 20px\"></span>\r\n          </p>\r\n        </el-form-item>\r\n        <el-form-item style=\"float:right;width: 350px\">\r\n          <p><label>建议排班人数：</label>\r\n            <el-input v-model=\"needpersons\" placeholder=\"18\" style=\"margin-top: 10px;width: 100px\"></el-input>\r\n          </p>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"submitForm(needpersons)\" style=\"float:right\">确定</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-dialog>\r\n\r\n    <div class=\"schedule\">\r\n      <weekDrag v-if=\"week_day === 'week'\" ref=\"weekDragRef\" :week_day=\"week_day\" :table=\"table\" :size=\"size\"\r\n                :timesWeek=\"timesWeek\" :tableData=\"tableData\" :viewValue=\"viewValue\" :loading=\"loading\"\r\n                @emitTableData=\"(tableData1) => tableData = tableData1\" @handleClickTd=\"(a, b) => handleClickTd(a, b)\"\r\n                @showAddView=\"(a, b, c) => showAddView(a, b, c)\" @message=\"(msg) => message(msg)\" />\r\n\r\n      <dayDrag v-if=\"week_day === 'day'\" ref=\"dayDragRef\" :week_day=\"week_day\" :dayData=\"dayData\" :timesDay=\"timesDay\"\r\n               :viewValue=\"viewValue\" :loading=\"loading\" :current=\"current\" @emitDayData=\"(dayData1) => dayData = dayData1\"\r\n               @handleClickTd=\"(a, b) => handleClickTd(a, b)\" @showAddView=\"(a, b, c) => showAddView(a, b, c)\"\r\n               @message=\"(msg) => message(msg)\" />\r\n    </div>\r\n\r\n    <el-dialog v-model=\"showDialog\" title=\"添加员工\" width=\"30%\" center draggable>\r\n      <el-form>\r\n        <el-form-item label=\"员工\">\r\n          <el-select v-model=\"employeeValue\" value-key=\"employeeId\" filterable>\r\n            <el-option v-for=\"employee in employeesAvail\" :key=\"employee.employeeId\"\r\n                       :label=\"employee.employeeName + '(' + employee.position + ')'\" :value=\"employee\" />\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n                <span class=\"dialog-footer\">\r\n                    <el-button @click=\"showDialog = false\">取消</el-button>\r\n                    <el-button type=\"primary\" @click=\"addEmplyee\">\r\n                        确定\r\n                    </el-button>\r\n                </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport moment from \"moment\";\r\nimport { Delete, Edit, Postcard, Finished } from '@element-plus/icons-vue';\r\nimport { ElMessage, ElMessageBox } from 'element-plus';\r\nimport SlideSelection from '../components/SlideSelection.vue'\r\nimport weekDrag from '../components/WeekDrag.vue'\r\nimport dayDrag from '../components/DayDrag.vue'\r\nimport {\r\n  getAllStore,\r\n  getAllEmployee,\r\n  getAWeekwork,\r\n  getADaywork,\r\n  deleteScheduling,\r\n  updateWeekData,\r\n  deleteDaySchedule,\r\n  replaceDaySchedule,\r\n  getPeriodAll,\r\n  getPeriodDay,\r\n  getSize, autoSchedul, getStorePersons\r\n} from '@/api';\r\nimport {events as ctx} from \"vuedraggable/src/core/sortableEvents\";\r\n\r\n/**\r\n * 初始化获取数据库数据：stores、data、employees\r\n */\r\n// 门店切换\r\nconst stores = ref([]);\r\nconst storeValue = ref();\r\n\r\n//所有员工数据\r\nconst employees = ref([]);\r\nconst employeesAvail = ref([]);\r\n\r\n//表格单元格数据\r\nvar data = [];\r\nconst tableData = ref([]);\r\nconst dayData = ref([]);\r\nconst weekIndex = [0, 1, 1, 1, 1, 1, 0];\r\n\r\n//表格左侧时间段\r\nconst timesWeek = ref([]);\r\nconst timesDay = ref([]);\r\nconst size = ref([]);\r\n\r\nlet persons = ref();\r\nconst needpersons = ref(18);\r\n\r\nlet dialogVisible = ref(false);\r\n\r\nconst submitForm=(needperson)=>{\r\n\r\n  // console.log(\"第一天\"+current.value.startOf('isoWeek').format('YYYY-MM-DD'))\r\n  let monday = current.value.startOf('isoWeek').format('YYYY-MM-DD');\r\n  console.log(storeValue.value+\"   \"+needperson+\"   \"+monday)\r\n  autoSchedul(storeValue.value,needperson,monday).then((datas)=>{\r\n    console.log(datas.data)\r\n  });\r\n  dialogVisible.value = false;\r\n}\r\n//初始化获取数据库\r\ngetAllStore().then((datas) => {\r\n  stores.value = datas.data;\r\n  storeValue.value = stores.value[0].storeId;\r\n\r\n  getPeriodAll(storeValue.value).then((datas) => {\r\n    timesWeek.value = datas.data;\r\n  })\r\n\r\n  getPeriodDay(storeValue.value, 1).then((datas) => {\r\n    timesDay.value.push(datas.data);\r\n  })\r\n\r\n  getPeriodDay(storeValue.value, 0).then((datas) => {\r\n    timesDay.value.push(datas.data);\r\n  })\r\n\r\n  getSize(storeValue.value).then((datas) => {\r\n    size.value = datas.data;\r\n  })\r\n\r\n  getAllEmployee(stores.value[0].storeId).then((datas) => {\r\n    employees.value = datas.data;\r\n    employeesAvail.value = [...employees.value];\r\n  });\r\n\r\n  loading.value = true;\r\n  getAWeekwork(moment().startOf('isoWeek').format('YYYY-MM-DD'), moment().endOf('isoWeek').format('YYYY-MM-DD'), storeValue.value)\r\n      .then((datas) => {\r\n        data = datas.data;\r\n        tableData.value = data[0].map(function (col, i) {\r\n          return data.map(function (row) {\r\n            return row[i];\r\n          })\r\n        });\r\n        console.log(tableData.value)\r\n        loading.value = false;\r\n      });\r\n\r\n  loading.value = true;\r\n  getADaywork(moment().format('YYYY-MM-DD'), weekIndex[moment().day()], storeValue.value)\r\n      .then((datas) => {\r\n        dayData.value = datas.data;\r\n        loading.value = false;\r\n      });\r\n});\r\n\r\n\r\n\r\n/**\r\n * 初始化本地变量\r\n */\r\n/* 固定变量 */\r\n//全部查看|按岗位分组|按员工分组\r\nconst viewMethods = [\r\n  {\r\n    label: 1,\r\n    value: '全部查看'\r\n  },\r\n  {\r\n    label: 2,\r\n    value: '按岗位分组'\r\n  },\r\n  {\r\n    label: 3,\r\n    value: '按员工分组'\r\n  }\r\n]\r\n\r\nconst slideRef = ref();\r\nconst weekDragRef = ref();\r\nconst dayDragRef = ref();\r\n\r\n\r\n\r\n/* 需修改变量 */\r\n//按周查看|按日查看 的切换\r\nconst week_day = ref('week');\r\n\r\n//全部查看|按岗位分组|按员工分组 的切换\r\nconst viewValue = ref(viewMethods[0].value);\r\n\r\nconst current = ref(moment());\r\nconst labels = ref([\r\n  '周一 ' + current.value.startOf('isoWeek').format('M月D日'),\r\n  '周二 ' + current.value.startOf('isoWeek').add(1, 'days').format('M月D日'),\r\n  '周三 ' + current.value.startOf('isoWeek').add(2, 'days').format('M月D日'),\r\n  '周四 ' + current.value.startOf('isoWeek').add(3, 'days').format('M月D日'),\r\n  '周五 ' + current.value.startOf('isoWeek').add(4, 'days').format('M月D日'),\r\n  '周六 ' + current.value.startOf('isoWeek').add(5, 'days').format('M月D日'),\r\n  '周日 ' + current.value.startOf('isoWeek').add(6, 'days').format('M月D日'),\r\n]);\r\n\r\n//被点击单元格的坐标s\r\nvar arrTd = [];\r\n\r\n//编辑button的文本切换\r\nconst edit = ref('编辑');\r\n\r\n//表格标签\r\nconst table = ref({\r\n  time: '时间',\r\n  week1: labels.value[0],\r\n  week2: labels.value[1],\r\n  week3: labels.value[2],\r\n  week4: labels.value[3],\r\n  week5: labels.value[4],\r\n  week6: labels.value[5],\r\n  week7: labels.value[6],\r\n});\r\n\r\n//加载数据\r\nconst loading = ref(true)\r\n\r\n//是否可拖拽drag，拖拽起点dragging，拖拽终点ending\r\nconst drag = ref(false);\r\nconst ending = ref(null);\r\nconst dragging = ref(null);\r\n\r\n//是否显示添加员工对话框\r\nconst showDialog = ref(false);\r\n//对话框里的员工下拉框\r\nconst employeeValue = ref('请选择要添加的员工');\r\n//已处于选中单元格中的员工s\r\nvar addIndex = null;\r\n\r\n\r\n\r\n/**\r\n * 函数\r\n */\r\n//修改门店\r\nconst changeStore = () => {\r\n  getStoreData();\r\n\r\n  //周切换\r\n  slideRef.value.initWeeks();\r\n\r\n  //日切换\r\n  slideRef.value.initDays();\r\n\r\n  initVariable();\r\n}\r\n\r\n//修改按周查看|按日查看\r\nconst chooseWorD = (button) => {\r\n  //获取数据库data、dayData\r\n  if (button === 'week' && week_day.value === 'day') {\r\n    week_day.value = 'week';\r\n\r\n    //周切换\r\n    slideRef.value.initWeeks();\r\n  }\r\n  else if (button === 'day' && week_day.value === 'week') {\r\n    week_day.value = 'day';\r\n\r\n    //日切换\r\n    slideRef.value.initDays();\r\n  }\r\n\r\n  initVariable();\r\n}\r\n\r\n//点击多选单元格\r\nconst handleClickTd = (row, col) => {\r\n  var flag = 0;\r\n  var td = document.getElementById('td' + week_day.value + row + '-' + col);\r\n\r\n  arrTd.map((value, index) => {\r\n    if (value.toString() === [row, col].toString()) {\r\n      arrTd.splice(index, 1);\r\n      td.style.backgroundColor = '';\r\n      flag = 1;\r\n      return;\r\n    }\r\n  })\r\n  if (flag === 0) {\r\n    arrTd.push([row, col]);\r\n    td.style.backgroundColor = '#ffe0e0';\r\n  }\r\n\r\n  console.log(arrTd);\r\n}\r\n//点击删除button删除单元格内容\r\nconst handleDelete = () => {\r\n  if (edit.value === '完成') {\r\n    message('正处于编辑状态，不可删除');\r\n  }\r\n  else if (arrTd.length === 0) {\r\n    message('请选择要删除内容的单元格');\r\n  }\r\n  else {\r\n    ElMessageBox.confirm(\r\n        '单元格内容将永久被删除，确定吗?',\r\n        'Warning',\r\n        {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning',\r\n        }\r\n    )\r\n        .then(() => {\r\n          if (week_day.value === 'week') {\r\n            var newData = [...tableData.value];\r\n            var deleteIds = [];\r\n            arrTd.map(value => {\r\n              if (value[1] < 5) {\r\n                if (tableData.value[value[0]][value[1]][1] !== null)\r\n                  deleteIds.push(tableData.value[value[0]][value[1]][1]);\r\n                newData[value[0]][value[1]] = [];\r\n              }\r\n              else {\r\n                if (tableData.value[value[0] - (size.value[0] - size.value[1])][value[1]][1] !== null)\r\n                  deleteIds.push(tableData.value[value[0] - (size.value[0] - size.value[1])][value[1]][1]);\r\n                newData[value[0] - (size.value[0] - size.value[1])][value[1]] = [];\r\n              }\r\n              let td = document.getElementById('td' + week_day.value + value[0] + '-' + value[1]);\r\n              // console.log(td)\r\n              td.style.backgroundColor = '';\r\n            })\r\n            tableData.value = [...newData];\r\n            deleteScheduling(deleteIds);\r\n          }\r\n          else {\r\n            var newDayData = [...dayData.value];\r\n            var updateIndexs = [];\r\n            var updateEmployeeIds = \"\";\r\n            arrTd.map((value, index) => {\r\n              if (JSON.stringify(newDayData[value[0]][value[1]]) !== '{}'\r\n                  && newDayData[value[0]][value[1]].employeeId !== null)\r\n                updateIndexs.push(value[0]);\r\n              newDayData[value[0]][value[1]] = {};\r\n              let td = document.getElementById('td' + week_day.value + value[0] + '-' + value[1]);\r\n              td.style.backgroundColor = '';\r\n            })\r\n            dayData.value = [...newDayData];\r\n\r\n            updateIndexs = [...new Set(updateIndexs)];\r\n            updateIndexs.map((value, index) => {\r\n              let employeeIds = \"\";\r\n              newDayData[value].map(v => {\r\n                if (v.employeeId !== null && JSON.stringify(v) !== '{}' && employeeIds === \"\")\r\n                  employeeIds += v.employeeId;\r\n                else if (v.employeeId !== null && JSON.stringify(v) !== '{}')\r\n                  employeeIds += \",\" + v.employeeId;\r\n              });\r\n              if (index === 0)\r\n                updateEmployeeIds += employeeIds;\r\n              else\r\n                updateEmployeeIds += \"=\" + employeeIds;\r\n            });\r\n            console.log(updateEmployeeIds)\r\n            console.log(current.value.format('YYYY-MM-DD'))\r\n            console.log(weekIndex[current.value.day()])\r\n            console.log(updateIndexs.join(','))\r\n            console.log(storeValue.value)\r\n            deleteDaySchedule(updateEmployeeIds, current.value.format('YYYY-MM-DD'),\r\n                weekIndex[current.value.day()], updateIndexs.join(','), storeValue.value);\r\n          }\r\n\r\n          arrTd.splice(0, arrTd.length);\r\n\r\n          ElMessage({\r\n            type: 'success',\r\n            message: '删除成功',\r\n          })\r\n        })\r\n        .catch(() => {\r\n          ElMessage({\r\n            type: 'info',\r\n            message: '取消删除',\r\n          })\r\n        })\r\n  }\r\n}\r\n//点击编辑|完成\r\nconst handleEdit = () => {\r\n  if (edit.value === '编辑') {\r\n    var tds = document.querySelectorAll('td');\r\n    for (var i = 1; i < tds.length; i++) {\r\n      if (tds[i].id !== 'td-time')\r\n        tds[i].style.backgroundColor = '';\r\n    }\r\n  }\r\n  else {\r\n    if (week_day.value === 'week') {\r\n      updateSchedule();\r\n    }\r\n    else {\r\n      var updateEmployeeIds = \"\";\r\n      dayData.value.map((value, index) => {\r\n        var employeeIds = \"\";\r\n        var flag = 0;\r\n        value.map((v, i) => {\r\n          if (JSON.stringify(v) !== '{}' && v.employeeId !== null && flag === 0) {\r\n            employeeIds += v.employeeId;\r\n            flag = 1;\r\n          }\r\n          else if (JSON.stringify(v) !== '{}' && v.employeeId !== null)\r\n            employeeIds += \",\" + v.employeeId;\r\n        });\r\n        if (index === 0)\r\n          updateEmployeeIds += employeeIds;\r\n        else\r\n          updateEmployeeIds += \"=\" + employeeIds;\r\n      });\r\n      replaceDaySchedule(updateEmployeeIds, storeValue.value, current.value.format('YYYY-MM-DD'), current.value.day());\r\n    }\r\n  }\r\n\r\n  if (week_day.value === 'week')\r\n    weekDragRef.value.weekEdit();\r\n  else\r\n    dayDragRef.value.dayEdit();\r\n\r\n  edit.value = (edit.value === '编辑' ? '完成' : '编辑');\r\n}\r\n\r\n//更新数据库排班数据\r\nconst updateSchedule = () => {\r\n  var tb = tableData.value.map(row => {\r\n    row = row.map(item => {\r\n      item = item.map((two, index) => {\r\n        if (index === 0) {\r\n          var tb1 = [];\r\n          two.map(em => {\r\n            tb1.push(JSON.stringify(em));\r\n          });\r\n          return tb1.join('>');\r\n        }\r\n        else return two;\r\n      });\r\n      return item.join('+');\r\n    });\r\n    return row.join('-');\r\n  });\r\n  var week = current.value.startOf('W').format(\"YYYY-MM-DD\");\r\n  for (var i = 1; i < 7; i++)\r\n    week += \",\" + current.value.startOf('W').add(i, 'days').format(\"YYYY-MM-DD\");\r\n  updateWeekData(tb.join('<'), week, storeValue.value);\r\n}\r\n\r\nconst dragInit = () => {\r\n  if (week_day.value === 'week')\r\n    weekDragRef.value.initDrag();\r\n  else\r\n    dayDragRef.value.initDrag();\r\n}\r\n\r\n//显示添加员工对话框、添加员工\r\nconst showAddView = (added, index1, index2) => {\r\n  console.log(added, index1, index2)\r\n  employeeValue.value = '请选择要添加的员工';\r\n  addIndex = [index1, index2];\r\n\r\n  var newEAvil = [...employees.value];\r\n  if (week_day.value === 'week') {\r\n    newEAvil = newEAvil.filter(item => {\r\n      var isInclude = false;\r\n\r\n      added.map((value) => {\r\n        if (value.employeeId === item.employeeId) {\r\n          isInclude = true;\r\n          return;\r\n        }\r\n      })\r\n      // console.log(isInclude);\r\n      return !isInclude;\r\n    });\r\n  }\r\n  else {\r\n    newEAvil = newEAvil.filter(item => {\r\n      var isInclude = false;\r\n\r\n      console.log(dayData.value[index1])\r\n      dayData.value[index1].map(value => {\r\n        console.log(value)\r\n        if (JSON.stringify(value) !== '{}' && value.employeeId !== null) {\r\n          if (value.employeeId === item.employeeId) {\r\n            isInclude = true;\r\n            return;\r\n          }\r\n        }\r\n      });\r\n      // console.log(isInclude);\r\n      return !isInclude;\r\n    });\r\n  }\r\n  employeesAvail.value = [...newEAvil];\r\n  console.log(employeesAvail)\r\n\r\n  showDialog.value = true;\r\n}\r\nconst addEmplyee = () => {\r\n  if (employeeValue.value === '请选择要添加的员工') {\r\n    message(\"请选择要添加的员工\");\r\n  } else {\r\n    if (week_day.value === 'week') {\r\n      let newData = [...tableData.value];\r\n      newData[addIndex[0]][addIndex[1]][0].push(employeeValue.value);\r\n      console.log(newData)\r\n      tableData.value = [...newData];\r\n    } else {\r\n      let newData = [...dayData.value];\r\n      newData[addIndex[0]][addIndex[1]] = employeeValue.value;\r\n      dayData.value = [...newData];\r\n    }\r\n  }\r\n\r\n  showDialog.value = false;\r\n}\r\n\r\n//工具类\r\nconst message = (str) => {\r\n  return (\r\n      ElMessage({\r\n        showClose: true,\r\n        message: str,\r\n        type: 'warning',\r\n        grouping: true\r\n      })\r\n  );\r\n}\r\nconst initVariable = () => {\r\n  //全部查看|按岗位分组|按员工分组 的切换\r\n  viewValue.value = viewMethods[0].value;\r\n\r\n  //被点击单元格的坐标s\r\n  arrTd = [];\r\n\r\n  //编辑button的文本切换\r\n  edit.value = '编辑';\r\n\r\n  //是否可拖拽drag，拖拽起点dragging，拖拽终点ending\r\n  drag.value = false;\r\n  ending.value = null;\r\n  dragging.value = null;\r\n\r\n  //是否显示添加员工对话框\r\n  showDialog.value = false;\r\n  //对话框里的员工下拉框\r\n  employeeValue.value = '请选择要添加的员工';\r\n  //已处于选中单元格中的员工s\r\n  addIndex = null;\r\n\r\n  var tds = document.querySelectorAll('td');\r\n  for (var i = 1; i < tds.length; i++) {\r\n    if (tds[i].id !== 'td-time')\r\n      tds[i].style.backgroundColor = '';\r\n  }\r\n}\r\nconst updateTableData = () => {\r\n  console.log(storeValue.value)\r\n  console.log(current.value)\r\n  loading.value = true;\r\n  getAWeekwork(current.value.startOf('isoWeek').format('YYYY-MM-DD'), current.value.endOf('isoWeek').format('YYYY-MM-DD'), storeValue.value)\r\n      .then((datas) => {\r\n        console.log(datas.data)\r\n        let data = datas.data;\r\n        tableData.value = data[0].map(function (col, i) {\r\n          return data.map(function (row) {\r\n            return row[i];\r\n          })\r\n        });\r\n        console.log(tableData.value)\r\n        loading.value = false;\r\n      });\r\n\r\n  console.log(tableData.value)\r\n}\r\nconst updateDayDate = () => {\r\n  loading.value = true;\r\n  getADaywork(current.value.format('YYYY-MM-DD'), weekIndex[current.value.day()], storeValue.value)\r\n      .then((datas) => {\r\n        dayData.value = datas.data;\r\n        loading.value = false;\r\n      });\r\n}\r\nconst getStoreData = () => {\r\n  console.log(storeValue.value)\r\n  getPeriodAll(storeValue.value).then((datas) => {\r\n    timesWeek.value = datas.data;\r\n  })\r\n\r\n  getPeriodDay(storeValue.value, 1).then((datas) => {\r\n    timesDay.value.push(datas.data);\r\n  })\r\n\r\n  getPeriodDay(storeValue.value, 0).then((datas) => {\r\n    timesDay.value.push(datas.data);\r\n  })\r\n\r\n  getSize(storeValue.value).then((datas) => {\r\n    size.value = datas.data;\r\n  })\r\n\r\n  getAllEmployee(stores.value[0].storeId).then((datas) => {\r\n    employees.value = datas.data;\r\n    employeesAvail.value = [...employees.value];\r\n  });\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  background-color: #fff;\r\n  border-radius: 15px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 20px;\r\n\r\n  .store {\r\n    margin-top: 10px;\r\n    margin-bottom: 10px;\r\n    border-radius: 10px;\r\n    display: flex;\r\n    align-self: center;\r\n  }\r\n\r\n  .time {\r\n    margin-bottom: 10px;\r\n  }\r\n\r\n  .view-options {\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 10px;\r\n\r\n    .view {\r\n      background-color: hsl(0, 0%, 89%);\r\n      padding: 5px;\r\n      border-radius: 5px;\r\n\r\n      .el-button {\r\n        border: none;\r\n        padding: 10px 30px;\r\n      }\r\n\r\n      .view-choose {\r\n        background-color: #fff;\r\n        color: #0a85ff;\r\n      }\r\n\r\n      .view-notchoose {\r\n        background-color: #e3e3e3;\r\n        color: #000;\r\n      }\r\n\r\n      .view-notchoose:hover {\r\n        background-color: #fff;\r\n        color: #000;\r\n      }\r\n    }\r\n  }\r\n\r\n  .view-button {\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 10px;\r\n\r\n    // .el-button {\r\n    //     background-color: #fff;\r\n    //     color: #0a85ff;\r\n    // }\r\n\r\n    // .el-button:hover {\r\n    //     background-color: #409EFF;\r\n    //     color: #fff;\r\n    // }\r\n\r\n    .button-choose {\r\n      background-color: #409EFF;\r\n      color: #fff;\r\n    }\r\n\r\n    .button-choose:hover {\r\n      background-color: #fff;\r\n      color: #0a85ff;\r\n    }\r\n  }\r\n\r\n  .schedule {\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n\r\n  .el-form {\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}