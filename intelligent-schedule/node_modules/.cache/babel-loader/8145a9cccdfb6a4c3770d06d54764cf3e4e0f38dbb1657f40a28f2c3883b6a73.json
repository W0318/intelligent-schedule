{"ast":null,"code":"import \"core-js/modules/es.array.unshift.js\";\nimport { getCustomerRule, updateCustomer, getCustomerByStoreId, insertCustomer, getAllRule, updateCustomerByStoreId } from \"@/api\";\nexport default {\n  inject: [\"reload\"],\n  name: \"CustomerShop\",\n  data() {\n    return {\n      rulenamee: \"\",\n      rulevaluee: \"\",\n      label111: -1,\n      //修改通用规则则为0，用通用规则但是分店则为1\n      label000: 0,\n      lengthh: 0,\n      tableData: [],\n      tableDatas: {\n        ruleTitle: \"\",\n        ruleValue: \"\"\n      },\n      addDialogVisible: false,\n      NoDelete: false,\n      NoDelete1: false,\n      Noemptyy: false,\n      addForm: {\n        ruleName: \"\",\n        ruleContent: \"\"\n      }\n    };\n  },\n  mounted() {\n    //获取通用规则\n    this.label111 = sessionStorage.getItem(\"label111\");\n    //不是总门店\n    if (this.label111 != -1) {\n      getCustomerByStoreId(this.label111).then(datas => {\n        //没有自己的规则就用通用规则\n        if (datas.data.length == 0) {\n          getCustomerRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.minNeed;\n            this.tableData[0].ruleTitle = \"最少所需人数\";\n            const rules = {\n              ruleTitle: \"客流计算公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            console.log(datas.data);\n            this.label000 = 1;\n          });\n        } else if (datas.data[0].ruleValue == '{\"formula\": \"\", \"minNeed\": \"\"}') {\n          getCustomerRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.minNeed;\n            this.tableData[0].ruleTitle = \"最少所需人数\";\n            const rules = {\n              ruleTitle: \"客流计算公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            console.log(datas.data);\n          });\n        } else {\n          this.tableData = datas.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.minNeed;\n          this.tableData[0].ruleTitle = \"最少所需人数\";\n          const rules = {\n            ruleTitle: \"客流计算公式\",\n            ruleValue: json.formula\n          };\n          this.tableData.unshift(rules);\n          console.log(datas.data);\n        }\n      });\n    } else if (this.label111 == -1) {\n      getCustomerRule().then(datas => {\n        this.tableData = datas.data;\n        let json = JSON.parse(this.tableData[0].ruleValue);\n        this.tableData[0].ruleValue = json.minNeed;\n        this.tableData[0].ruleTitle = \"最少所需人数\";\n        const rules = {\n          ruleTitle: \"客流计算公式\",\n          ruleValue: json.formula\n        };\n        this.tableData.unshift(rules);\n        console.log(datas.data);\n      });\n    }\n  },\n  methods: {\n    handleEdit(index, row) {\n      getAllRule().then(datas => {\n        // console.log(datas.data.length);\n        console.log(\"label000:\" + this.label000);\n        console.log(\"label111:\" + this.label111);\n      });\n      this.addDialogVisible = true;\n      this.rulenamee = this.tableData[index].ruleTitle;\n      // console.log(this.rulenamee);\n      this.rulevaluee = this.tableData[index].ruleValue;\n      // console.log(this.rulevaluee);\n    },\n\n    //删除规则\n    async handleDelete(index, row) {\n      this.rulenamee = this.tableData[index].ruleTitle;\n      if (this.label111 != -1 && this.label000 == 0) {\n        if (this.rulenamee == \"客流计算公式\") {\n          this.sstr = '{\"formula\": \"\", \"minNeed\": \"' + this.tableData[1].ruleValue + '\"}';\n          console.log(this.sstr);\n        } else {\n          this.sstr = '{\"formula\": \"' + this.tableData[0].ruleValue + '\", \"minNeed\": \"\"}';\n          console.log(this.sstr);\n        }\n        console.log(this.rulevaluee);\n        await updateCustomerByStoreId(this.label111, this.sstr);\n        this.addDialogVisible = false;\n        await getCustomerByStoreId(this.label111).then(datass => {\n          this.tableData = datass.data;\n          let json = JSON.parse(this.tableData[0].ruleValue);\n          this.tableData[0].ruleValue = json.minNeed;\n          this.tableData[0].ruleTitle = \"最少所需人数\";\n          const rules = {\n            ruleTitle: \"客流计算公式\",\n            ruleValue: json.formula\n          };\n          this.tableData.unshift(rules);\n          console.log(datass.data);\n        });\n      } else if (this.label111 == -1) {\n        this.NoDelete = true;\n      } else {\n        this.NoDelete1 = true;\n      }\n    },\n    //点击确认编辑button确认编辑规则\n    async handelUpdate() {\n      if (this.rulevaluee == \"\") {\n        this.Noemptyy = true;\n      } else {\n        //是分店\n        if (this.label111 != -1) {\n          //分店无独立规则，插入一条新规则\n          if (this.label000 == 1) {\n            if (this.rulenamee == \"客流计算公式\") {\n              this.sstr = '{\"formula\": \"' + this.rulevaluee + '\", \"minNeed\": \"' + this.tableData[1].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"formula\": \"' + this.tableData[0].ruleValue + '\", \"minNeed\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            getAllRule().then(async datas => {\n              this.lengthh = datas.data.length + 1;\n              this.lengthh = this.lengthh.toString();\n              console.log(this.lengthh);\n              console.log(this.label111);\n              await insertCustomer(this.lengthh, this.label111, this.sstr);\n              this.addDialogVisible = false;\n              // this.sleep(10000);\n              await getCustomerByStoreId(this.label111).then(datass => {\n                this.tableData = datass.data;\n                let json = JSON.parse(this.tableData[0].ruleValue);\n                console.log(\"minNeed:\" + json.minNeed + \"formula:\" + json.formula);\n                this.tableData[0].ruleValue = json.minNeed;\n                this.tableData[0].ruleTitle = \"最少所需人数\";\n                const rules = {\n                  ruleTitle: \"客流计算公式\",\n                  ruleValue: json.formula\n                };\n                this.tableData.unshift(rules);\n                console.log(datass.data);\n              });\n              // this.reload();\n            });\n          }\n          //分店有独立规则则进行编辑（update\n          else {\n            if (this.rulenamee == \"客流计算公式\") {\n              this.sstr = '{\"formula\": \"' + this.rulevaluee + '\", \"minNeed\": \"' + this.tableData[1].ruleValue + '\"}';\n              console.log(this.sstr);\n            } else {\n              this.sstr = '{\"formula\": \"' + this.tableData[0].ruleValue + '\", \"minNeed\": \"' + this.rulevaluee + '\"}';\n              console.log(this.sstr);\n            }\n            console.log(this.rulevaluee);\n            await updateCustomerByStoreId(this.label111, this.sstr);\n            this.addDialogVisible = false;\n            await getCustomerByStoreId(this.label111).then(datass => {\n              this.tableData = datass.data;\n              let json = JSON.parse(this.tableData[0].ruleValue);\n              this.tableData[0].ruleValue = json.minNeed;\n              this.tableData[0].ruleTitle = \"最少所需人数\";\n              const rules = {\n                ruleTitle: \"客流计算公式\",\n                ruleValue: json.formula\n              };\n              this.tableData.unshift(rules);\n              console.log(datass.data);\n            });\n            // this.reload();\n          }\n        }\n        //不是分店\n        else {\n          if (this.rulenamee == \"客流计算公式\") {\n            this.sstr = '{\"formula\": \"' + this.rulevaluee + '\", \"minNeed\": \"' + this.tableData[1].ruleValue + '\"}';\n            console.log(this.sstr);\n          } else {\n            this.sstr = '{\"formula\": \"' + this.tableData[0].ruleValue + '\", \"minNeed\": \"' + this.rulevaluee + '\"}';\n            console.log(this.sstr);\n          }\n          console.log(this.rulevaluee);\n          await updateCustomer(this.sstr);\n          this.addDialogVisible = false;\n          await getCustomerRule().then(datas => {\n            this.tableData = datas.data;\n            let json = JSON.parse(this.tableData[0].ruleValue);\n            this.tableData[0].ruleValue = json.minNeed;\n            this.tableData[0].ruleTitle = \"最少所需人数\";\n            const rules = {\n              ruleTitle: \"客流计算公式\",\n              ruleValue: json.formula\n            };\n            this.tableData.unshift(rules);\n            console.log(datas.data);\n          });\n          // this.reload();\n        }\n      }\n    },\n\n    getCustomerRules() {\n      getCustomerRule().then(datas => {\n        this.tableData.ruleTitle = datas.data[0].ruleTitle;\n        this.tableData.rulevaluee = datas.data[0].ruleValue;\n        console.log(datas.data);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["getCustomerRule","updateCustomer","getCustomerByStoreId","insertCustomer","getAllRule","updateCustomerByStoreId","inject","name","data","rulenamee","rulevaluee","label111","label000","lengthh","tableData","tableDatas","ruleTitle","ruleValue","addDialogVisible","NoDelete","NoDelete1","Noemptyy","addForm","ruleName","ruleContent","mounted","sessionStorage","getItem","then","datas","length","json","JSON","parse","minNeed","rules","formula","unshift","console","log","methods","handleEdit","index","row","handleDelete","sstr","datass","handelUpdate","toString","getCustomerRules"],"sourceRoot":"","sources":["E:\\work\\vue\\schedule\\intelligent-schedule\\src\\views\\ShiftSchedule\\components\\CustomerRules.vue"],"sourcesContent":["<template>\r\n  <div class=\"rules\">\r\n    <div class=\"title\">\r\n      <h2>客流规则</h2>\r\n    </div>\r\n    <div class=\"rulesList\">\r\n      <el-table :data=\"tableData\" style=\"width: 100%\" stripe>\r\n        <el-table-column label=\"\" prop=\"ruleTitle\"> </el-table-column>\r\n        <el-table-column label=\"\" prop=\"ruleValue\"> </el-table-column>\r\n        <el-table-column label=\"\">\r\n          <template v-slot=\"scope\">\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"primary\"\r\n              @click=\"handleEdit(scope.$index, scope.row)\"\r\n            >\r\n              编辑\r\n            </el-link>\r\n            <el-link\r\n              size=\"mini\"\r\n              type=\"danger\"\r\n              @click=\"handleDelete(scope.$index, scope.row)\"\r\n              >删除</el-link\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <!-- 新建规则对话框 -->\r\n    <el-dialog v-model=\"addDialogVisible\" title=\"编辑规则\" width=\"30%\">\r\n      <el-form :model=\"addForm\">\r\n        <el-form-item :label=\"rulenamee\" label-width=\"60%\"> </el-form-item>\r\n        <el-form-item label=\"规则内容：\" prop=\"rulevaluee\">\r\n          <el-input\r\n            v-model=\"this.rulevaluee\"\r\n            placeholder=\"请输入规则内容\"\r\n            clearable\r\n            :style=\"{ width: '100%' }\"\r\n          >\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handelUpdate\"> 确定 </el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n        <!-- 提示框 -->\r\n        <el-dialog v-model=\"NoDelete\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm\">\r\n        <el-form-item label=\"无法删除通用规则\" label-width=\"66%\" prop=\"nono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"NoDelete1\" title=\"无法删除\" width=\"30%\">\r\n      <el-form :model=\"deleteForm1\">\r\n        <el-form-item\r\n          label=\"该分店无独立规则，无法进行删除操作\"\r\n          label-width=\"90%\"\r\n          prop=\"nono\"\r\n        >\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"NoDelete1 = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n    <!-- 提示框 -->\r\n    <el-dialog v-model=\"Noemptyy\" title=\"不能为空\" width=\"30%\">\r\n      <el-form :model=\"Noempty\">\r\n        <el-form-item label=\"输入值不能为空\" label-width=\"66%\" prop=\"nonono\">\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button @click=\"Noemptyy = false\">确定</el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getCustomerRule,\r\n  updateCustomer,\r\n  getCustomerByStoreId,\r\n  insertCustomer,\r\n  getAllRule,\r\n  updateCustomerByStoreId,\r\n} from \"@/api\";\r\n\r\nexport default {\r\n  inject: [\"reload\"],\r\n  name: \"CustomerShop\",\r\n  data() {\r\n    return {\r\n      rulenamee: \"\",\r\n      rulevaluee: \"\",\r\n      label111: -1,\r\n      //修改通用规则则为0，用通用规则但是分店则为1\r\n      label000: 0,\r\n      lengthh: 0,\r\n\r\n      tableData: [],\r\n\r\n      tableDatas: {\r\n        ruleTitle: \"\",\r\n        ruleValue: \"\",\r\n      },\r\n\r\n      addDialogVisible: false,\r\n      NoDelete: false,\r\n      NoDelete1: false,\r\n      Noemptyy: false,\r\n      addForm: {\r\n        ruleName: \"\",\r\n        ruleContent: \"\",\r\n      },\r\n    };\r\n  },\r\n\r\n  mounted() {\r\n    //获取通用规则\r\n    this.label111 = sessionStorage.getItem(\"label111\");\r\n    //不是总门店\r\n    if (this.label111 != -1) {\r\n      getCustomerByStoreId(this.label111).then((datas) => {\r\n        //没有自己的规则就用通用规则\r\n        if (datas.data.length == 0) {\r\n          getCustomerRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.minNeed;\r\n            this.tableData[0].ruleTitle = \"最少所需人数\";\r\n            const rules = {\r\n              ruleTitle: \"客流计算公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            console.log(datas.data);\r\n            this.label000 = 1;\r\n          });\r\n        } else if (\r\n          datas.data[0].ruleValue == '{\"formula\": \"\", \"minNeed\": \"\"}'\r\n        ) {\r\n          getCustomerRule().then((datas) => {\r\n            this.tableData = datas.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.minNeed;\r\n            this.tableData[0].ruleTitle = \"最少所需人数\";\r\n            const rules = {\r\n              ruleTitle: \"客流计算公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            console.log(datas.data);\r\n          });\r\n        } else {\r\n          this.tableData = datas.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.minNeed;\r\n          this.tableData[0].ruleTitle = \"最少所需人数\";\r\n          const rules = { ruleTitle: \"客流计算公式\", ruleValue: json.formula };\r\n          this.tableData.unshift(rules);\r\n          console.log(datas.data);\r\n        }\r\n      });\r\n    } else if (this.label111 == -1) {\r\n      getCustomerRule().then((datas) => {\r\n        this.tableData = datas.data;\r\n        let json = JSON.parse(this.tableData[0].ruleValue);\r\n        this.tableData[0].ruleValue = json.minNeed;\r\n        this.tableData[0].ruleTitle = \"最少所需人数\";\r\n        const rules = { ruleTitle: \"客流计算公式\", ruleValue: json.formula };\r\n        this.tableData.unshift(rules);\r\n        console.log(datas.data);\r\n      });\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    handleEdit(index, row) {\r\n      getAllRule().then((datas) => {\r\n        // console.log(datas.data.length);\r\n        console.log(\"label000:\" + this.label000);\r\n        console.log(\"label111:\" + this.label111);\r\n      });\r\n      this.addDialogVisible = true;\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      // console.log(this.rulenamee);\r\n      this.rulevaluee = this.tableData[index].ruleValue;\r\n      // console.log(this.rulevaluee);\r\n    },\r\n\r\n    //删除规则\r\n    async handleDelete(index, row) {\r\n      this.rulenamee = this.tableData[index].ruleTitle;\r\n      if (this.label111 != -1 && this.label000 == 0) {\r\n        if (this.rulenamee == \"客流计算公式\") {\r\n          this.sstr =\r\n            '{\"formula\": \"\", \"minNeed\": \"' + this.tableData[1].ruleValue + '\"}';\r\n          console.log(this.sstr);\r\n        } else {\r\n          this.sstr =\r\n            '{\"formula\": \"' + this.tableData[0].ruleValue + '\", \"minNeed\": \"\"}';\r\n          console.log(this.sstr);\r\n        }\r\n        console.log(this.rulevaluee);\r\n        await updateCustomerByStoreId(this.label111, this.sstr);\r\n        this.addDialogVisible = false;\r\n        await getCustomerByStoreId(this.label111).then((datass) => {\r\n          this.tableData = datass.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.minNeed;\r\n          this.tableData[0].ruleTitle = \"最少所需人数\";\r\n          const rules = {\r\n            ruleTitle: \"客流计算公式\",\r\n            ruleValue: json.formula,\r\n          };\r\n          this.tableData.unshift(rules);\r\n          console.log(datass.data);\r\n        });\r\n      }else if (this.label111 == -1) {\r\n        this.NoDelete = true;\r\n      } else {\r\n        this.NoDelete1 = true;\r\n      }\r\n    },\r\n\r\n\r\n    //点击确认编辑button确认编辑规则\r\n    async handelUpdate() {\r\n      if (this.rulevaluee == \"\") {\r\n        this.Noemptyy = true;\r\n      } else {\r\n      //是分店\r\n      if (this.label111 != -1) {\r\n        //分店无独立规则，插入一条新规则\r\n        if (this.label000 == 1) {\r\n          if (this.rulenamee == \"客流计算公式\") {\r\n            this.sstr =\r\n              '{\"formula\": \"' +\r\n              this.rulevaluee +\r\n              '\", \"minNeed\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else {\r\n            this.sstr =\r\n              '{\"formula\": \"' +\r\n              this.tableData[0].ruleValue +\r\n              '\", \"minNeed\": \"' +\r\n              this.rulevaluee +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          }\r\n          getAllRule().then(async (datas) => {\r\n            this.lengthh = datas.data.length + 1;\r\n            this.lengthh = this.lengthh.toString();\r\n            console.log(this.lengthh);\r\n            console.log(this.label111);\r\n            await insertCustomer(this.lengthh, this.label111, this.sstr);\r\n            this.addDialogVisible = false;\r\n            // this.sleep(10000);\r\n            await getCustomerByStoreId(this.label111).then((datass) => {\r\n              this.tableData = datass.data;\r\n              let json = JSON.parse(this.tableData[0].ruleValue);\r\n              console.log(\r\n                \"minNeed:\" + json.minNeed + \"formula:\" + json.formula\r\n              );\r\n              this.tableData[0].ruleValue = json.minNeed;\r\n              this.tableData[0].ruleTitle = \"最少所需人数\";\r\n              const rules = {\r\n                ruleTitle: \"客流计算公式\",\r\n                ruleValue: json.formula,\r\n              };\r\n              this.tableData.unshift(rules);\r\n              console.log(datass.data);\r\n            });\r\n            // this.reload();\r\n          });\r\n        }\r\n        //分店有独立规则则进行编辑（update\r\n        else {\r\n          if (this.rulenamee == \"客流计算公式\") {\r\n            this.sstr =\r\n              '{\"formula\": \"' +\r\n              this.rulevaluee +\r\n              '\", \"minNeed\": \"' +\r\n              this.tableData[1].ruleValue +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          } else {\r\n            this.sstr =\r\n              '{\"formula\": \"' +\r\n              this.tableData[0].ruleValue +\r\n              '\", \"minNeed\": \"' +\r\n              this.rulevaluee +\r\n              '\"}';\r\n            console.log(this.sstr);\r\n          }\r\n          console.log(this.rulevaluee);\r\n          await updateCustomerByStoreId(this.label111, this.sstr);\r\n          this.addDialogVisible = false;\r\n          await getCustomerByStoreId(this.label111).then((datass) => {\r\n            this.tableData = datass.data;\r\n            let json = JSON.parse(this.tableData[0].ruleValue);\r\n            this.tableData[0].ruleValue = json.minNeed;\r\n            this.tableData[0].ruleTitle = \"最少所需人数\";\r\n            const rules = {\r\n              ruleTitle: \"客流计算公式\",\r\n              ruleValue: json.formula,\r\n            };\r\n            this.tableData.unshift(rules);\r\n            console.log(datass.data);\r\n          });\r\n          // this.reload();\r\n        }\r\n      }\r\n      //不是分店\r\n      else {\r\n        if (this.rulenamee == \"客流计算公式\") {\r\n          this.sstr =\r\n            '{\"formula\": \"' +\r\n            this.rulevaluee +\r\n            '\", \"minNeed\": \"' +\r\n            this.tableData[1].ruleValue +\r\n            '\"}';\r\n          console.log(this.sstr);\r\n        } else {\r\n          this.sstr =\r\n            '{\"formula\": \"' +\r\n            this.tableData[0].ruleValue +\r\n            '\", \"minNeed\": \"' +\r\n            this.rulevaluee +\r\n            '\"}';\r\n          console.log(this.sstr);\r\n        }\r\n        console.log(this.rulevaluee);\r\n        await updateCustomer(this.sstr);\r\n        this.addDialogVisible = false;\r\n        await getCustomerRule().then((datas) => {\r\n          this.tableData = datas.data;\r\n          let json = JSON.parse(this.tableData[0].ruleValue);\r\n          this.tableData[0].ruleValue = json.minNeed;\r\n          this.tableData[0].ruleTitle = \"最少所需人数\";\r\n          const rules = { ruleTitle: \"客流计算公式\", ruleValue: json.formula };\r\n          this.tableData.unshift(rules);\r\n          console.log(datas.data);\r\n        });\r\n        // this.reload();\r\n      }\r\n    }\r\n    },\r\n\r\n    getCustomerRules() {\r\n      getCustomerRule().then((datas) => {\r\n        this.tableData.ruleTitle = datas.data[0].ruleTitle;\r\n        this.tableData.rulevaluee = datas.data[0].ruleValue;\r\n        console.log(datas.data);\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.el-link {\r\n  margin-left: 17px;\r\n}\r\n.rules {\r\n  .title {\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n  .rulesList {\r\n    margin-top: 20px;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}